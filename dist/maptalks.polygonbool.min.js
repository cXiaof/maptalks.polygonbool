/*!
 * maptalks.polygonbool v0.1.0-alpha.3
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(){function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}}();function r(t,e){return e<t?1:t<e?-1:0}var d=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}return i.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},i.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},i.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},i.prototype.splay=function(t){for(var e,r,o,n,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((o=r.parent).left===r?o.left=t:o.right=t,t.parent=o):(t.parent=null,this._root=t),n=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,(e.right=r).parent=e):(n?(r.right=n).parent=r:r.right=null,(t.left=r).parent=t)),i?(e.left=i).parent=e:e.left=null,(t.right=e).parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,(e.left=r).parent=e):(i?(r.left=i).parent=r:r.left=null,(t.right=r).parent=t)),n?(e.right=n).parent=e:e.right=null,(t.left=e).parent=t)},i.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},i.prototype.minNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t},i.prototype.insert=function(t,e){var r=this._root,o=null,n=this._compare;if(this._noDuplicates)for(;r;){if(0===n((o=r).key,t))return;r=n(r.key,t)<0?r.right:r.left}else for(;r;)r=n((o=r).key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:o},o?n(o.key,r.key)<0?o.right=r:o.left=r:this._root=r,this.splay(r),this._size++,r},i.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var o=r(e.key,t);if(o<0)e=e.right;else{if(!(0<o))return e;e=e.left}}return null},i.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var o=r(t,e.key);if(0===o)return!0;e=o<0?e.left:e.right}return!1},i.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},i.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},i.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,o=e.right,n=null;r&&(r.parent=null,n=this.maxNode(r),this.splay(n),this._root=n),o&&(r?n.right=o:this._root=o,o.parent=n),this._size--}},i.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},i.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},i.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},i.prototype.forEach=function(t){for(var e=this._root,r=[],o=!1,n=0;!o;)e?(r.push(e),e=e.left):0<r.length?(t(e=r.pop(),n++),e=e.right):o=!0;return this},i.prototype.range=function(t,e,r,o){for(var n=[],i=this._compare,a=this._root;0!==n.length||a;)if(a)n.push(a),a=a.left;else{if(0<i((a=n.pop()).key,e))break;if(0<=i(a.key,t)&&r.call(o,a))return this;a=a.right}return this},i.prototype.keys=function(){for(var t=this._root,e=[],r=[],o=!1;!o;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.key),t=t.right):o=!0;return r},i.prototype.values=function(){for(var t=this._root,e=[],r=[],o=!1;!o;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.data),t=t.right):o=!0;return r},i.prototype.at=function(t){for(var e=this._root,r=[],o=!1,n=0;!o;)if(e)r.push(e),e=e.left;else if(0<r.length){if(e=r.pop(),n===t)return e;n++,e=e.right}else o=!0;return null},i.prototype.load=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var o=t.length;return r&&function t(e,r,o,n,i){if(n<=o)return;var a=e[o+n>>1];var s=o-1;var u=n+1;for(;;){for(;i(e[++s],a)<0;);for(;0<i(e[--u],a););if(u<=s)break;var h=e[s];e[s]=e[u],e[u]=h,h=r[s],r[s]=r[u],r[u]=h}t(e,r,o,u,i);t(e,r,u+1,n,i)}(t,e,0,o-1,this._compare),this._root=function t(e,r,o,n,i){var a=i-n;if(0<a){var s=n+Math.floor(a/2),u=r[s],h=o[s],l={key:u,data:h,parent:e};return l.left=t(l,r,o,n,s),l.right=t(l,r,o,s+1,i),l}return null}(null,t,e,0,o),this._size=o,this},i.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},i.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},i.prototype.isEmpty=function(){return null===this._root},i.createTree=function(t,e,r,o,n){return new i(r,n).load(t,e,o)},e(i,[{key:"size",get:function(){return this._size}}]),i}();var a=0,u=1,h=2,l=3,g=0,b=1,m=2,j=3;function S(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!o(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=o(t,r)}function o(t,e){switch(t.type){case a:switch(e){case g:return!t.otherInOut;case b:return t.otherInOut;case m:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case j:return!0}break;case h:return e===g||e===b;case l:return e===m;case u:return!1}return!1}var v=function(){function i(t,e,r,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.left=e,this.point=t,this.otherEvent=r,this.isSubject=o,this.type=n||a,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}return i.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]):0<(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])},i.prototype.isAbove=function(t){return!this.isBelow(t)},i.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},i.prototype.clone=function(){var t=new i(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},i}();function f(t,e){return t[0]===e[0]&&t[1]===e[1]}function n(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function O(t,e){var r=t.point,o=e.point;return r[0]>o[0]?1:r[0]<o[0]?-1:r[1]!==o[1]?r[1]>o[1]?1:-1:function(t,e,r,o){if(t.left!==e.left)return t.left?1:-1;if(0!==n(r,t.otherEvent.point,e.otherEvent.point))return t.isBelow(e.otherEvent.point)?-1:1;return!t.isSubject&&e.isSubject?1:-1}(t,e,r)}function p(t,e,r){var o=new v(e,!1,t,t.isSubject),n=new v(e,!0,t.otherEvent,t.isSubject);return f(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),o.contourId=n.contourId=t.contourId,0<O(n,t.otherEvent)&&(t.otherEvent.left=!0,n.left=!1),t.otherEvent.otherEvent=n,t.otherEvent=o,r.push(n),r.push(o),r}function E(t,e){return t[0]*e[1]-t[1]*e[0]}function w(t,e){return t[0]*e[0]+t[1]*e[1]}var c=function(t,e,r,o,n){var i=[e[0]-t[0],e[1]-t[1]],a=[o[0]-r[0],o[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}var u=[r[0]-t[0],r[1]-t[1]],h=E(i,a),l=h*h,f=w(i,i);if(0<l){var p=E(u,a)/h;if(p<0||1<p)return null;var c=E(u,i)/h;return c<0||1<c?null:0===p||1===p?n?null:[s(t,p,i)]:0===c||1===c?n?null:[s(r,c,a)]:[s(t,p,i)]}if(0<(l=(h=E(u,i))*h))return null;var v=w(i,u)/f,y=v+w(i,a)/f,_=Math.min(v,y),d=Math.max(v,y);return _<=1&&0<=d?1===_?n?null:[s(t,0<_?_:0,i)]:0===d?n?null:[s(t,d<1?d:1,i)]:n&&0===_&&1===d?null:[s(t,0<_?_:0,i),s(t,d<1?d:1,i)]:null};function k(t,e,r){var o=c(t.point,t.otherEvent.point,e.point,e.otherEvent.point),n=o?o.length:0;if(0===n)return 0;if(1===n&&(f(t.point,e.point)||f(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===n&&t.isSubject===e.isSubject)return 0;if(1===n)return f(t.point,o[0])||f(t.otherEvent.point,o[0])||p(t,o[0],r),f(e.point,o[0])||f(e.otherEvent.point,o[0])||p(e,o[0],r),1;var i=[],a=!1,s=!1;return f(t.point,e.point)?a=!0:1===O(t,e)?i.push(e,t):i.push(t,e),f(t.otherEvent.point,e.otherEvent.point)?s=!0:1===O(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=u,t.type=e.inOut===t.inOut?h:l,a&&!s&&p(i[1].otherEvent,i[0].point,r),2):(s?p(i[0],i[1].point,r):i[0]!==i[3].otherEvent?(p(i[0],i[1].point,r),p(i[1],i[2].point,r)):(p(i[0],i[1].point,r),p(i[3].otherEvent,i[2].point,r)),3)}function I(t,e){if(t===e)return 0;if(0!==n(t.point,t.otherEvent.point,e.point)||0!==n(t.point,t.otherEvent.point,e.otherEvent.point))return f(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===O(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,o=e.point;return r[0]===o[0]&&r[1]===o[1]?(r=t.otherEvent.point,o=e.otherEvent.point,r[0]===o[0]&&r[1]===o[1]?0:t.contourId>e.contourId?1:-1):1===O(t,e)?1:-1}function y(t,e,r,o){var n=t+1,i=e.length;if(i-1<n)return t-1;for(var a=e[t].point,s=e[n].point;n<i&&s[0]===a[0]&&s[1]===a[1];){if(!r[n])return n;s=e[++n].point}for(n=t-1;r[n]&&o<=n;)n--;return n}function T(t,e){var r,o=void 0,n=function(t){var e=void 0,r=void 0,o=void 0,n=void 0,i=[];for(r=0,o=t.length;r<o;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);for(var a=!1;!a;)for(a=!0,r=0,o=i.length;r<o;r++)r+1<o&&1===O(i[r],i[r+1])&&(n=i[r],i[r]=i[r+1],i[r+1]=n,a=!1);for(r=0,o=i.length;r<o;r++)(e=i[r]).pos=r;for(r=0,o=i.length;r<o;r++)(e=i[r]).left||(n=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=n);return i}(t),i={},a=[],s=void 0;for(o=0,r=n.length;o<r;o++)if(!i[o]){var u=[[]];n[o].isExteriorRing?e===m&&!n[o].isSubject&&1<a.length?a[a.length-1].push(u[0]):a.push(u):e!==m||n[o].isSubject||0!==a.length?0===a.length?a.push([[u]]):a[a.length-1].push(u[0]):a.push(u);var h=a.length-1,l=o,f=n[o].point;for(u[0].push(f);o<=l;)s=n[l],i[l]=!0,s.left?(s.resultInOut=!1,s.contourId=h):(s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h),i[l=s.pos]=!0,u[0].push(n[l].point),l=y(l,n,i,o);s=n[l=-1===l?o:l],i[l]=i[s.pos]=!0,s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h}return a}var G=s,i=s;function s(t,e){if(!(this instanceof s))return new s(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||_,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function _(t,e){return t<e?-1:e<t?1:0}s.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,o=e[t];0<t;){var n=t-1>>1,i=e[n];if(0<=r(o,i))break;e[t]=i,t=n}e[t]=o},_down:function(t){for(var e=this.data,r=this.compare,o=this.length>>1,n=e[t];t<o;){var i=1+(t<<1),a=i+1,s=e[i];if(a<this.length&&r(e[a],s)<0&&(s=e[i=a]),0<=r(s,n))break;e[t]=s,t=i}e[t]=n}},G.default=i;var P=Math.max,R=Math.min,x=0;function A(t,e,r,o,n,i){var a,s=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(s=0,a=t.length-1;s<a;s++)if(u=t[s],h=t[s+1],l=new v(u,!1,void 0,e),f=new v(h,!1,l,e),l.otherEvent=f,u[0]!==h[0]||u[1]!==h[1]){l.contourId=f.contourId=r,i||(l.isExteriorRing=!1,f.isExteriorRing=!1),0<O(l,f)?f.left=!0:l.left=!0;var p=u[0],c=u[1];n[0]=R(n[0],p),n[1]=R(n[1],c),n[2]=P(n[2],p),n[3]=P(n[3],c),o.push(l),o.push(f)}}var z=[];function C(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var o,n,i,a,s=(n=e,i=r,a=null,(o=t).length*n.length==0&&(i===g?a=z:i===m?a=o:i!==b&&i!==j||(a=0===o.length?n:o)),a);if(s)return s===z?null:s;var u,h,l,f,p,c,v=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=function(t,e,r,o,n){var i=new G(null,O),a=void 0,s=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(u=0,h=t.length;u<h;u++)for(l=0,f=(a=t[u]).length;l<f;l++)(s=0===l)&&x++,A(a[l],!0,x,i,r,s);for(u=0,h=e.length;u<h;u++)for(l=0,f=(a=e[u]).length;l<f;l++)s=0===l,n===m&&(s=!1),s&&x++,A(a[l],!1,x,i,o,s);return i}(t,e,v,y,r);return u=t,h=e,p=r,c=null,((l=v)[0]>(f=y)[2]||f[0]>l[2]||l[1]>f[3]||f[1]>l[3])&&(p===g?c=z:p===m?c=u:p!==b&&p!==j||(c=u.concat(h))),(s=c)?s===z?null:s:T(function(t,e,r,o,n,i){for(var a=new d(I),s=[],u=Math.min(o[2],n[2]),h=void 0,l=void 0,f=void 0;0!==t.length;){var p=t.pop();if(s.push(p),i===g&&p.point[0]>u||i===m&&p.point[0]>o[2])break;if(p.left){l=h=a.insert(p),h=h!==(f=a.minNode())?a.prev(h):null,l=a.next(l);var c=h?h.key:null;if(S(p,c,i),l&&2===k(p,l.key,t)&&(S(p,c,i),S(p,l.key,i)),h&&2===k(h.key,p,t)){var v=h;S(c,(v=v!==f?a.prev(v):null)?v.key:null,i),S(p,c,i)}}else p=p.otherEvent,l=h=a.find(p),h&&l&&(h=h!==f?a.prev(h):null,l=a.next(l),a.remove(p),l&&h&&k(h.key,l.key,t))}return s}(_,0,0,v,y,r),r)}var L=function(){this.__data__=[],this.size=0};var M=function(t,e){return t===e||t!=t&&e!=e};var N=function(t,e){for(var r=t.length;r--;)if(M(t[r][0],e))return r;return-1},B=Array.prototype.splice;var D=function(t){var e=this.__data__,r=N(e,t);return!(r<0||(r==e.length-1?e.pop():B.call(e,r,1),--this.size,0))};var F=function(t){var e=this.__data__,r=N(e,t);return r<0?void 0:e[r][1]};var W=function(t){return-1<N(this.__data__,t)};var U=function(t,e){var r=this.__data__,o=N(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this};function V(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}V.prototype.clear=L,V.prototype.delete=D,V.prototype.get=F,V.prototype.has=W,V.prototype.set=U;var $=V;var H=function(){this.__data__=new $,this.size=0};var J=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var q=function(t){return this.__data__.get(t)};var X=function(t){return this.__data__.has(t)},Y="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function K(t,e){return t(e={exports:{}},e.exports),e.exports}var Q="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(Y)&&Y&&Y.Object===Object&&Y,Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt="object"==("undefined"==typeof self?"undefined":Z(self))&&self&&self.Object===Object&&self,et=Q||tt||Function("return this")(),rt=et.Symbol,ot=Object.prototype,nt=ot.hasOwnProperty,it=ot.toString,at=rt?rt.toStringTag:void 0;var st=function(t){var e=nt.call(t,at),r=t[at];try{var o=!(t[at]=void 0)}catch(t){}var n=it.call(t);return o&&(e?t[at]=r:delete t[at]),n},ut=Object.prototype.toString;var ht=function(t){return ut.call(t)},lt=rt?rt.toStringTag:void 0;var ft=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":lt&&lt in Object(t)?st(t):ht(t)},pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var ct=function(t){var e=void 0===t?"undefined":pt(t);return null!=t&&("object"==e||"function"==e)};var vt,yt=function(t){if(!ct(t))return!1;var e=ft(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},_t=et["__core-js_shared__"],dt=(vt=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||""))?"Symbol(src)_1."+vt:"";var gt=function(t){return!!dt&&dt in t},bt=Function.prototype.toString;var mt=function(t){if(null!=t){try{return bt.call(t)}catch(t){}try{return t+""}catch(t){}}return""},jt=/^\[object .+?Constructor\]$/,St=Function.prototype,Ot=Object.prototype,Et=St.toString,wt=Ot.hasOwnProperty,kt=RegExp("^"+Et.call(wt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var It=function(t){return!(!ct(t)||gt(t))&&(yt(t)?kt:jt).test(mt(t))};var Tt=function(t,e){return null==t?void 0:t[e]};var Gt=function(t,e){var r=Tt(t,e);return It(r)?r:void 0},Pt=Gt(et,"Map"),Rt=Gt(Object,"create");var xt=function(){this.__data__=Rt?Rt(null):{},this.size=0};var At=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},zt=Object.prototype.hasOwnProperty;var Ct=function(t){var e=this.__data__;if(Rt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return zt.call(e,t)?e[t]:void 0},Lt=Object.prototype.hasOwnProperty;var Mt=function(t){var e=this.__data__;return Rt?void 0!==e[t]:Lt.call(e,t)};var Nt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Rt&&void 0===e?"__lodash_hash_undefined__":e,this};function Bt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Bt.prototype.clear=xt,Bt.prototype.delete=At,Bt.prototype.get=Ct,Bt.prototype.has=Mt,Bt.prototype.set=Nt;var Dt=Bt;var Ft=function(){this.size=0,this.__data__={hash:new Dt,map:new(Pt||$),string:new Dt}},Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Ut=function(t){var e=void 0===t?"undefined":Wt(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Vt=function(t,e){var r=t.__data__;return Ut(e)?r["string"==typeof e?"string":"hash"]:r.map};var $t=function(t){var e=Vt(this,t).delete(t);return this.size-=e?1:0,e};var Ht=function(t){return Vt(this,t).get(t)};var Jt=function(t){return Vt(this,t).has(t)};var qt=function(t,e){var r=Vt(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this};function Xt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Xt.prototype.clear=Ft,Xt.prototype.delete=$t,Xt.prototype.get=Ht,Xt.prototype.has=Jt,Xt.prototype.set=qt;var Yt=Xt;var Kt=function(t,e){var r=this.__data__;if(r instanceof $){var o=r.__data__;if(!Pt||o.length<199)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new Yt(o)}return r.set(t,e),this.size=r.size,this};function Qt(t){var e=this.__data__=new $(t);this.size=e.size}Qt.prototype.clear=H,Qt.prototype.delete=J,Qt.prototype.get=q,Qt.prototype.has=X,Qt.prototype.set=Kt;var Zt=Qt;var te=function(t){return this.__data__.has(t)};function ee(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Yt;++e<r;)this.add(t[e])}ee.prototype.add=ee.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ee.prototype.has=te;var re=ee;var oe=function(t,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(e(t[r],r,t))return!0;return!1};var ne=function(t,e){return t.has(e)};var ie=function(t,e,r,o,n,i){var a=1&r,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;var h=i.get(t);if(h&&i.get(e))return h==e;var l=-1,f=!0,p=2&r?new re:void 0;for(i.set(t,e),i.set(e,t);++l<s;){var c=t[l],v=e[l];if(o)var y=a?o(v,c,l,e,t,i):o(c,v,l,t,e,i);if(void 0!==y){if(y)continue;f=!1;break}if(p){if(!oe(e,function(t,e){if(!ne(p,e)&&(c===t||n(c,t,r,o,i)))return p.push(e)})){f=!1;break}}else if(c!==v&&!n(c,v,r,o,i)){f=!1;break}}return i.delete(t),i.delete(e),f},ae=et.Uint8Array;var se=function(t){var r=-1,o=Array(t.size);return t.forEach(function(t,e){o[++r]=[e,t]}),o};var ue=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r},he=rt?rt.prototype:void 0,le=he?he.valueOf:void 0;var fe=function(t,e,r,o,n,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new ae(t),new ae(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return M(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=se;case"[object Set]":var u=1&o;if(s||(s=ue),t.size!=e.size&&!u)return!1;var h=a.get(t);if(h)return h==e;o|=2,a.set(t,e);var l=ie(s(t),s(e),o,n,i,a);return a.delete(t),l;case"[object Symbol]":if(le)return le.call(t)==le.call(e)}return!1};var pe=function(t,e){for(var r=-1,o=e.length,n=t.length;++r<o;)t[n+r]=e[r];return t},ce=Array.isArray;var ve=function(t,e,r){var o=e(t);return ce(t)?o:pe(o,r(t))};var ye=function(t,e){for(var r=-1,o=null==t?0:t.length,n=0,i=[];++r<o;){var a=t[r];e(a,r,t)&&(i[n++]=a)}return i};var _e=function(){return[]},de=Object.prototype.propertyIsEnumerable,ge=Object.getOwnPropertySymbols,be=ge?function(e){return null==e?[]:(e=Object(e),ye(ge(e),function(t){return de.call(e,t)}))}:_e;var me=function(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o},je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Se=function(t){return null!=t&&"object"==(void 0===t?"undefined":je(t))};var Oe=function(t){return Se(t)&&"[object Arguments]"==ft(t)},Ee=Object.prototype,we=Ee.hasOwnProperty,ke=Ee.propertyIsEnumerable,Ie=Oe(function(){return arguments}())?Oe:function(t){return Se(t)&&we.call(t,"callee")&&!ke.call(t,"callee")};var Te=function(){return!1},Ge=K(function(t,e){var r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,n=o&&o.exports===r?et.Buffer:void 0,i=(n?n.isBuffer:void 0)||Te;t.exports=i}),Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Re=/^(?:0|[1-9]\d*)$/;var xe=function(t,e){var r=void 0===t?"undefined":Pe(t);return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Re.test(t))&&-1<t&&t%1==0&&t<e};var Ae=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},ze={};ze["[object Float32Array]"]=ze["[object Float64Array]"]=ze["[object Int8Array]"]=ze["[object Int16Array]"]=ze["[object Int32Array]"]=ze["[object Uint8Array]"]=ze["[object Uint8ClampedArray]"]=ze["[object Uint16Array]"]=ze["[object Uint32Array]"]=!0,ze["[object Arguments]"]=ze["[object Array]"]=ze["[object ArrayBuffer]"]=ze["[object Boolean]"]=ze["[object DataView]"]=ze["[object Date]"]=ze["[object Error]"]=ze["[object Function]"]=ze["[object Map]"]=ze["[object Number]"]=ze["[object Object]"]=ze["[object RegExp]"]=ze["[object Set]"]=ze["[object String]"]=ze["[object WeakMap]"]=!1;var Ce=function(t){return Se(t)&&Ae(t.length)&&!!ze[ft(t)]};var Le=function(e){return function(t){return e(t)}},Me=K(function(t,e){var r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,n=o&&o.exports===r&&Q.process,i=function(){try{var t=o&&o.require&&o.require("util").types;return t||n&&n.binding&&n.binding("util")}catch(t){}}();t.exports=i}),Ne=Me&&Me.isTypedArray,Be=Ne?Le(Ne):Ce,De=Object.prototype.hasOwnProperty;var Fe=function(t,e){var r=ce(t),o=!r&&Ie(t),n=!r&&!o&&Ge(t),i=!r&&!o&&!n&&Be(t),a=r||o||n||i,s=a?me(t.length,String):[],u=s.length;for(var h in t)!e&&!De.call(t,h)||a&&("length"==h||n&&("offset"==h||"parent"==h)||i&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||xe(h,u))||s.push(h);return s},We=Object.prototype;var Ue=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||We)};var Ve=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),$e=Object.prototype.hasOwnProperty;var He=function(t){if(!Ue(t))return Ve(t);var e=[];for(var r in Object(t))$e.call(t,r)&&"constructor"!=r&&e.push(r);return e};var Je=function(t){return null!=t&&Ae(t.length)&&!yt(t)};var qe=function(t){return Je(t)?Fe(t):He(t)};var Xe=function(t){return ve(t,qe,be)},Ye=Object.prototype.hasOwnProperty;var Ke=function(t,e,r,o,n,i){var a=1&r,s=Xe(t),u=s.length;if(u!=Xe(e).length&&!a)return!1;for(var h=u;h--;){var l=s[h];if(!(a?l in e:Ye.call(e,l)))return!1}var f=i.get(t);if(f&&i.get(e))return f==e;var p=!0;i.set(t,e),i.set(e,t);for(var c=a;++h<u;){var v=t[l=s[h]],y=e[l];if(o)var _=a?o(y,v,l,e,t,i):o(v,y,l,t,e,i);if(!(void 0===_?v===y||n(v,y,r,o,i):_)){p=!1;break}c||(c="constructor"==l)}if(p&&!c){var d=t.constructor,g=e.constructor;d!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof d&&d instanceof d&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i.delete(t),i.delete(e),p},Qe=Gt(et,"DataView"),Ze=Gt(et,"Promise"),tr=Gt(et,"Set"),er=Gt(et,"WeakMap"),rr="[object Map]",or="[object Promise]",nr="[object Set]",ir="[object WeakMap]",ar="[object DataView]",sr=mt(Qe),ur=mt(Pt),hr=mt(Ze),lr=mt(tr),fr=mt(er),pr=ft;(Qe&&pr(new Qe(new ArrayBuffer(1)))!=ar||Pt&&pr(new Pt)!=rr||Ze&&pr(Ze.resolve())!=or||tr&&pr(new tr)!=nr||er&&pr(new er)!=ir)&&(pr=function(t){var e=ft(t),r="[object Object]"==e?t.constructor:void 0,o=r?mt(r):"";if(o)switch(o){case sr:return ar;case ur:return rr;case hr:return or;case lr:return nr;case fr:return ir}return e});var cr=pr,vr="[object Arguments]",yr="[object Array]",_r="[object Object]",dr=Object.prototype.hasOwnProperty;var gr=function(t,e,r,o,n,i){var a=ce(t),s=ce(e),u=a?yr:cr(t),h=s?yr:cr(e),l=(u=u==vr?_r:u)==_r,f=(h=h==vr?_r:h)==_r,p=u==h;if(p&&Ge(t)){if(!Ge(e))return!1;l=!(a=!0)}if(p&&!l)return i||(i=new Zt),a||Be(t)?ie(t,e,r,o,n,i):fe(t,e,u,r,o,n,i);if(!(1&r)){var c=l&&dr.call(t,"__wrapped__"),v=f&&dr.call(e,"__wrapped__");if(c||v){var y=c?t.value():t,_=v?e.value():e;return i||(i=new Zt),n(y,_,r,o,i)}}return!!p&&(i||(i=new Zt),Ke(t,e,r,o,n,i))};var br=function t(e,r,o,n,i){return e===r||(null==e||null==r||!Se(e)&&!Se(r)?e!=e&&r!=r:gr(e,r,o,n,t,i))};var mr=function(t,e){return br(t,e)};function jr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),o=0;o<r.length;o++){var n=r[o],i=Object.getOwnPropertyDescriptor(e,n);i&&i.configurable&&void 0===t[n]&&Object.defineProperty(t,n,i)}}(t,e))}var Sr=function(r){function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,r.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}return jr(o,r),o.prototype.intersection=function(t,e){this._setTaskSafety("intersection");var r=this._initialTask(t,e);if(r)return this.remove(),r},o.prototype.union=function(t,e){this._setTaskSafety("union");var r=this._initialTask(t,e);if(r)return this.remove(),r},o.prototype.diff=function(t,e){this._setTaskSafety("diff");var r=this._initialTask(t,e);if(r)return this.remove(),r},o.prototype.xor=function(t,e){this._setTaskSafety("xor");var r=this._initialTask(t,e);if(r)return this.remove(),r},o.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};this._dealWithTargets(),t(this._result,this._deals),this.remove()},o.prototype.cancel=function(){this.remove()},o.prototype.remove=function(){this._map;this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._chooseLayer,delete this._mousemove,delete this._click},o.prototype._setTaskSafety=function(t){map._map_tool&&drawTool instanceof maptalks.DrawTool&&drawTool.disable(),this.geometry&&this.remove(),this._task=t},o.prototype._initialTask=function(t,e){if(this._checkAvailGeoType(t)){if(this._savePrivateGeometry(t),this._checkAvailGeoType(e)&&(e=[e]),!(e instanceof Array&&0<e.length))return t.copy();if(this._dealWithTargets(e),this._result){var r=this._result;return this.remove(),r}}},o.prototype._checkAvailGeoType=function(t){return t instanceof maptalks.Polygon||t instanceof maptalks.MultiPolygon},o.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},o.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),this._map=t,this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},o.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},o.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},o.prototype._mousemoveEvents=function(t){var r=this,o=[],n=this._getSafeCoords();this.layer.identify(t.coordinate).forEach(function(t){var e=r._getSafeCoords(t);!mr(e,n)&&r._checkAvailGeoType(t)&&o.push(t)}),this._updateHitGeo(o)},o.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var r=t.options,o=r.numberOfShellPoints;r.numberOfShellPoints=300,t.setOptions(r),e=[t.getShell()],r.numberOfShellPoints=o||60,t.setOptions(r)}return e},o.prototype._updateHitGeo=function(t){if(this._needRefreshSymbol){var e=this._chooseLayer.getGeometryById("_hit");e&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length){this._needRefreshSymbol=!0,this.hitGeo=t[0];var r=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,r).setId("_hit")}},o.prototype._getSymbolOrDefault=function(t,e){var r=t.getSymbol(),o=this["_color"+e];if(r){for(var n in r)(n.endsWith("Fill")||n.endsWith("Color"))&&(r[n]=o);r.lineWidth=4}else r={lineColor:o,lineWidth:4};return r},o.prototype._copyGeoUpdateSymbol=function(t,e){var r=this._getSafeCoords(t);return(t instanceof maptalks.Polygon?new maptalks.Polygon(r):new maptalks.MultiPolygon(r)).updateSymbol(e).addTo(this._chooseLayer)},o.prototype._clickEvents=function(t){if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}},o.prototype._setChooseGeosExceptHit=function(r,t){var o=this,n=[];this._chooseGeos.forEach(function(t){var e=o._getSafeCoords(t);mr(r,e)||n.push(t)}),t||n.length!==this._chooseGeos.length?this._chooseGeos=n:this._chooseGeos.push(this.hitGeo)},o.prototype._updateChooseGeos=function(){var r=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=r._getSymbolOrDefault(t,"Choose");r._copyGeoUpdateSymbol(t,e)})},o.prototype._dealWithTargets=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,r=void 0;this._deals=[],t.forEach(function(t){null!==r&&(r=r?e._getBoolResultGeo(t,r):e._getBoolResultGeo(t)),e._deals.push(t.copy())}),this._result=r},o.prototype._getBoolResultGeo=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.geometry,r=this._getGeoJSONCoords(e),o=this._getGeoJSONCoords(t);if(!this.options.includeSame&&mr(r,o))return e;var n=void 0;try{n=C(r,o,this._getBoolType())}catch(t){}var i=this.geometry.getSymbol(),a=this.geometry.getProperties();if(!n)return null;return 1===n.length?new maptalks.Polygon(n[0],{symbol:i,properties:a}):new maptalks.MultiPolygon(n,{symbol:i,properties:a})},o.prototype._getGeoJSONCoords=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry).toGeoJSON().geometry.coordinates},o.prototype._getBoolType=function(){return{intersection:0,union:1,diff:2,xor:3}[this._task]},o}(maptalks.Class);Sr.mergeOptions({includeSame:!0}),t.PolygonBool=Sr,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.polygonbool v0.1.0-alpha.3")});