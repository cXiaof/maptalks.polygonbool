/*!
 * maptalks.polygonbool v0.1.0-beta.1
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t};function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function r(t,e){return e<t?1:t<e?-1:0}var y=(i.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},i.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},i.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},i.prototype.splay=function(t){for(var e,r,o,n,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((o=r.parent).left===r?o.left=t:o.right=t,t.parent=o):(t.parent=null,this._root=t),n=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,(e.right=r).parent=e):(n?(r.right=n).parent=r:r.right=null,(t.left=r).parent=t)),i?(e.left=i).parent=e:e.left=null,(t.right=e).parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,(e.left=r).parent=e):(i?(r.left=i).parent=r:r.left=null,(t.right=r).parent=t)),n?(e.right=n).parent=e:e.right=null,(t.left=e).parent=t)},i.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},i.prototype.minNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t},i.prototype.insert=function(t,e){var r=this._root,o=null,n=this._compare;if(this._noDuplicates)for(;r;){if(0===n((o=r).key,t))return;r=n(r.key,t)<0?r.right:r.left}else for(;r;)r=n((o=r).key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:o},o?n(o.key,r.key)<0?o.right=r:o.left=r:this._root=r,this.splay(r),this._size++,r},i.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var o=r(e.key,t);if(o<0)e=e.right;else{if(!(0<o))return e;e=e.left}}return null},i.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var o=r(t,e.key);if(0===o)return!0;e=o<0?e.left:e.right}return!1},i.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},i.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},i.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,o=e.right,n=null;r&&(r.parent=null,n=this.maxNode(r),this.splay(n),this._root=n),o&&(r?n.right=o:this._root=o,o.parent=n),this._size--}},i.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},i.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},i.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},i.prototype.forEach=function(t){for(var e=this._root,r=[],o=!1,n=0;!o;)e?(r.push(e),e=e.left):0<r.length?(t(e=r.pop(),n++),e=e.right):o=!0;return this},i.prototype.range=function(t,e,r,o){for(var n=[],i=this._compare,a=this._root;0!==n.length||a;)if(a)n.push(a),a=a.left;else{if(0<i((a=n.pop()).key,e))break;if(0<=i(a.key,t)&&r.call(o,a))return this;a=a.right}return this},i.prototype.keys=function(){for(var t=this._root,e=[],r=[],o=!1;!o;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.key),t=t.right):o=!0;return r},i.prototype.values=function(){for(var t=this._root,e=[],r=[],o=!1;!o;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.data),t=t.right):o=!0;return r},i.prototype.at=function(t){for(var e=this._root,r=[],o=!1,n=0;!o;)if(e)r.push(e),e=e.left;else if(0<r.length){if(e=r.pop(),n===t)return e;n++,e=e.right}else o=!0;return null},i.prototype.load=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var o=t.length;return r&&function t(e,r,o,n,i){if(!(n<=o)){for(var a=e[o+n>>1],s=o-1,u=n+1;;){for(;i(e[++s],a)<0;);for(;0<i(e[--u],a););if(u<=s)break;var h=e[s];e[s]=e[u],e[u]=h,h=r[s],r[s]=r[u],r[u]=h}t(e,r,o,u,i),t(e,r,u+1,n,i)}}(t,e,0,o-1,this._compare),this._root=function t(e,r,o,n,i){var a=i-n;if(0<a){var s=n+Math.floor(a/2),u=r[s],h=o[s],l={key:u,data:h,parent:e};return l.left=t(l,r,o,n,s),l.right=t(l,r,o,s+1,i),l}return null}(null,t,e,0,o),this._size=o,this},i.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},i.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},i.prototype.isEmpty=function(){return null===this._root},i.createTree=function(t,e,r,o,n){return new i(r,n).load(t,e,o)},e(i,[{key:"size",get:function(){return this._size}}]),i);function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}var a=0,u=1,h=2,l=3,_=0,s=1,d=2,f=3;function g(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!n(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=n(t,r)}function n(t,e){switch(t.type){case a:switch(e){case _:return!t.otherInOut;case s:return t.otherInOut;case d:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case f:return!0}break;case h:return e===_||e===s;case l:return e===d;case u:return!1}return!1}var v=(p.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]):0<(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])},p.prototype.isAbove=function(t){return!this.isBelow(t)},p.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},p.prototype.clone=function(){var t=new p(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},p);function p(t,e,r,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),this.left=e,this.point=t,this.otherEvent=r,this.isSubject=o,this.type=n||a,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}function c(t,e){return t[0]===e[0]&&t[1]===e[1]}function b(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function m(t,e){var r=t.point,o=e.point;return r[0]>o[0]?1:r[0]<o[0]?-1:r[1]!==o[1]?r[1]>o[1]?1:-1:function(t,e,r,o){return t.left!==e.left?t.left?1:-1:0===b(r,t.otherEvent.point,e.otherEvent.point)?!t.isSubject&&e.isSubject?1:-1:t.isBelow(e.otherEvent.point)?-1:1}(t,e,r)}function j(t,e,r){var o=new v(e,!1,t,t.isSubject),n=new v(e,!0,t.otherEvent,t.isSubject);return c(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),o.contourId=n.contourId=t.contourId,0<m(n,t.otherEvent)&&(t.otherEvent.left=!0,n.left=!1),t.otherEvent.otherEvent=n,t.otherEvent=o,r.push(n),r.push(o),r}function S(t,e){return t[0]*e[1]-t[1]*e[0]}function O(t,e){return t[0]*e[0]+t[1]*e[1]}var E=function(t,e,r,o,n){var i=[e[0]-t[0],e[1]-t[1]],a=[o[0]-r[0],o[1]-r[1]];function s(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}var u=[r[0]-t[0],r[1]-t[1]],h=S(i,a),l=h*h,f=O(i,i);if(0<l){var p=S(u,a)/h;if(p<0||1<p)return null;var c=S(u,i)/h;return c<0||1<c?null:0==p||1==p?n?null:[s(t,p,i)]:0==c||1==c?n?null:[s(r,c,a)]:[s(t,p,i)]}if(0<(l=(h=S(u,i))*h))return null;var v=O(i,u)/f,y=v+O(i,a)/f,_=Math.min(v,y),d=Math.max(v,y);return _<=1&&0<=d?1===_?n?null:[s(t,0<_?_:0,i)]:0===d?n?null:[s(t,d<1?d:1,i)]:n&&0===_&&1===d?null:[s(t,0<_?_:0,i),s(t,d<1?d:1,i)]:null};function w(t,e,r){var o=E(t.point,t.otherEvent.point,e.point,e.otherEvent.point),n=o?o.length:0;if(0===n)return 0;if(1===n&&(c(t.point,e.point)||c(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===n&&t.isSubject===e.isSubject)return 0;if(1===n)return c(t.point,o[0])||c(t.otherEvent.point,o[0])||j(t,o[0],r),c(e.point,o[0])||c(e.otherEvent.point,o[0])||j(e,o[0],r),1;var i=[],a=!1,s=!1;return c(t.point,e.point)?a=!0:1===m(t,e)?i.push(e,t):i.push(t,e),c(t.otherEvent.point,e.otherEvent.point)?s=!0:1===m(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),a&&s||a?(e.type=u,t.type=e.inOut===t.inOut?h:l,a&&!s&&j(i[1].otherEvent,i[0].point,r),2):(s?j(i[0],i[1].point,r):i[0]!==i[3].otherEvent?(j(i[0],i[1].point,r),j(i[1],i[2].point,r)):(j(i[0],i[1].point,r),j(i[3].otherEvent,i[2].point,r)),3)}function k(t,e){if(t===e)return 0;if(0!==b(t.point,t.otherEvent.point,e.point)||0!==b(t.point,t.otherEvent.point,e.otherEvent.point))return c(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===m(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,o=e.point;return r[0]===o[0]&&r[1]===o[1]?(r=t.otherEvent.point,o=e.otherEvent.point,r[0]===o[0]&&r[1]===o[1]?0:t.contourId>e.contourId?1:-1):1===m(t,e)?1:-1}function I(t,e,r,o){var n,i=void 0,a=t+1,s=e.length;for(n=e[t].point,a<s&&(i=e[a].point);a<s&&i[0]===n[0]&&i[1]===n[1];){if(!r[a])return a;i=e[++a].point}for(a=t-1;r[a]&&o<=a;)a--;return a}function G(t,e){var r,o=void 0,n=function(t){var e=void 0,r=void 0,o=void 0,n=void 0,i=[];for(r=0,o=t.length;r<o;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);for(var a=!1;!a;)for(a=!0,r=0,o=i.length;r<o;r++)r+1<o&&1===m(i[r],i[r+1])&&(n=i[r],i[r]=i[r+1],i[r+1]=n,a=!1);for(r=0,o=i.length;r<o;r++)(e=i[r]).pos=r;for(r=0,o=i.length;r<o;r++)(e=i[r]).left||(n=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=n);return i}(t),i={},a=[],s=void 0;for(o=0,r=n.length;o<r;o++)if(!i[o]){var u=[[]];n[o].isExteriorRing?e===d&&!n[o].isSubject&&1<a.length?a[a.length-1].push(u[0]):a.push(u):e!==d||n[o].isSubject||0!==a.length?0===a.length?a.push([[u]]):a[a.length-1].push(u[0]):a.push(u);var h=a.length-1,l=o,f=n[o].point;for(u[0].push(f);o<=l;)s=n[l],i[l]=!0,s.left?(s.resultInOut=!1,s.contourId=h):(s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h),i[l=s.pos]=!0,u[0].push(n[l].point),l=I(l,n,i,o);s=n[l=-1===l?o:l],i[l]=i[s.pos]=!0,s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h}return a}var P=R,T=R;function R(t,e){if(!(this instanceof R))return new R(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||x,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function x(t,e){return t<e?-1:e<t?1:0}R.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,o=e[t];0<t;){var n=t-1>>1,i=e[n];if(0<=r(o,i))break;e[t]=i,t=n}e[t]=o},_down:function(t){for(var e=this.data,r=this.compare,o=this.length>>1,n=e[t];t<o;){var i=1+(t<<1),a=i+1,s=e[i];if(a<this.length&&r(e[a],s)<0&&(s=e[i=a]),0<=r(s,n))break;e[t]=s,t=i}e[t]=n}},P.default=T;var A=Math.max,z=Math.min,C=0;function N(t,e,r,o,n,i){var a,s=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(s=0,a=t.length-1;s<a;s++)if(u=t[s],h=t[s+1],l=new v(u,!1,void 0,e),f=new v(h,!1,l,e),l.otherEvent=f,u[0]!==h[0]||u[1]!==h[1]){l.contourId=f.contourId=r,i||(l.isExteriorRing=!1,f.isExteriorRing=!1),0<m(l,f)?f.left=!0:l.left=!0;var p=u[0],c=u[1];n[0]=z(n[0],p),n[1]=z(n[1],c),n[2]=A(n[2],p),n[3]=A(n[3],c),o.push(l),o.push(f)}}var L=[];function M(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var o=function(t,e,r){var o=null;return t.length*e.length==0&&(r===_?o=L:r===d?o=t:r!==s&&r!==f||(o=0===t.length?e:t)),o}(t,e,r);if(o)return o===L?null:o;var n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,o,n){var i=new P(null,m),a=void 0,s=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(u=0,h=t.length;u<h;u++)for(l=0,f=(a=t[u]).length;l<f;l++)(s=0===l)&&C++,N(a[l],!0,C,i,r,s);for(u=0,h=e.length;u<h;u++)for(l=0,f=(a=e[u]).length;l<f;l++)s=0===l,n===d&&(s=!1),s&&C++,N(a[l],!1,C,i,o,s);return i}(t,e,n,i,r);return(o=function(t,e,r,o,n){var i=null;return(r[0]>o[2]||o[0]>r[2]||r[1]>o[3]||o[1]>r[3])&&(n===_?i=L:n===d?i=t:n!==s&&n!==f||(i=t.concat(e))),i}(t,e,n,i,r))?o===L?null:o:G(function(t,e,r,o,n,i){for(var a=new y(k),s=[],u=Math.min(o[2],n[2]),h=void 0,l=void 0,f=void 0;0!==t.length;){var p=t.pop();if(s.push(p),i===_&&p.point[0]>u||i===d&&p.point[0]>o[2])break;if(p.left){l=h=a.insert(p),h=h!==(f=a.minNode())?a.prev(h):null,l=a.next(l);var c=h?h.key:null;if(g(p,c,i),l&&2===w(p,l.key,t)&&(g(p,c,i),g(p,l.key,i)),h&&2===w(h.key,p,t)){var v=h;g(c,(v=v!==f?a.prev(v):null)?v.key:null,i),g(p,c,i)}}else p=p.otherEvent,l=h=a.find(p),h&&l&&(h=h!==f?a.prev(h):null,l=a.next(l),a.remove(p),l&&h&&w(h.key,l.key,t))}return s}(a,0,0,n,i,r),r)}function B(){this.__data__=[],this.size=0}var D=function(t,e){return t===e||t!=t&&e!=e};var F=function(t,e){for(var r=t.length;r--;)if(D(t[r][0],e))return r;return-1},W=Array.prototype.splice;function U(t){var e=this.__data__,r=F(e,t);return!(r<0||(r==e.length-1?e.pop():W.call(e,r,1),--this.size,0))}function V(t){var e=this.__data__,r=F(e,t);return r<0?void 0:e[r][1]}function $(t){return-1<F(this.__data__,t)}function H(t,e){var r=this.__data__,o=F(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}function J(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}J.prototype.clear=B,J.prototype.delete=U,J.prototype.get=V,J.prototype.has=$,J.prototype.set=H;var q=J;function X(){this.__data__=new q,this.size=0}function Y(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function K(t){return this.__data__.get(t)}function Q(t){return this.__data__.has(t)}var Z="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function tt(t,e){return t(e={exports:{}},e.exports),e.exports}var et="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(Z)&&Z&&Z.Object===Object&&Z,rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot="object"==("undefined"==typeof self?"undefined":rt(self))&&self&&self.Object===Object&&self,nt=et||ot||Function("return this")(),it=nt.Symbol,at=Object.prototype,st=at.hasOwnProperty,ut=at.toString,ht=it?it.toStringTag:void 0;var lt=function(t){var e=st.call(t,ht),r=t[ht];try{var o=!(t[ht]=void 0)}catch(t){}var n=ut.call(t);return o&&(e?t[ht]=r:delete t[ht]),n},ft=Object.prototype.toString;var pt=function(t){return ft.call(t)},ct=it?it.toStringTag:void 0;var vt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":ct&&ct in Object(t)?lt(t):pt(t)},yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var _t=function(t){var e=void 0===t?"undefined":yt(t);return null!=t&&("object"==e||"function"==e)};var dt,gt=function(t){if(!_t(t))return!1;var e=vt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},bt=nt["__core-js_shared__"],mt=(dt=/[^.]+$/.exec(bt&&bt.keys&&bt.keys.IE_PROTO||""))?"Symbol(src)_1."+dt:"";var jt=function(t){return!!mt&&mt in t},St=Function.prototype.toString;var Ot=function(t){if(null!=t){try{return St.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Et=/^\[object .+?Constructor\]$/,wt=Function.prototype,kt=Object.prototype,It=wt.toString,Gt=kt.hasOwnProperty,Pt=RegExp("^"+It.call(Gt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Tt=function(t){return!(!_t(t)||jt(t))&&(gt(t)?Pt:Et).test(Ot(t))};var Rt=function(t,e){return null==t?void 0:t[e]};var xt=function(t,e){var r=Rt(t,e);return Tt(r)?r:void 0},At=xt(nt,"Map"),zt=xt(Object,"create");function Ct(){this.__data__=zt?zt(null):{},this.size=0}function Nt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Lt=Object.prototype.hasOwnProperty;function Mt(t){var e=this.__data__;if(zt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return Lt.call(e,t)?e[t]:void 0}var Bt=Object.prototype.hasOwnProperty;function Dt(t){var e=this.__data__;return zt?void 0!==e[t]:Bt.call(e,t)}function Ft(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=zt&&void 0===e?"__lodash_hash_undefined__":e,this}function Wt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Wt.prototype.clear=Ct,Wt.prototype.delete=Nt,Wt.prototype.get=Mt,Wt.prototype.has=Dt,Wt.prototype.set=Ft;var Ut=Wt;function Vt(){this.size=0,this.__data__={hash:new Ut,map:new(At||q),string:new Ut}}var $t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Ht=function(t){var e=void 0===t?"undefined":$t(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Jt=function(t,e){var r=t.__data__;return Ht(e)?r["string"==typeof e?"string":"hash"]:r.map};function qt(t){var e=Jt(this,t).delete(t);return this.size-=e?1:0,e}function Xt(t){return Jt(this,t).get(t)}function Yt(t){return Jt(this,t).has(t)}function Kt(t,e){var r=Jt(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}function Qt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}Qt.prototype.clear=Vt,Qt.prototype.delete=qt,Qt.prototype.get=Xt,Qt.prototype.has=Yt,Qt.prototype.set=Kt;var Zt=Qt;function te(t,e){var r=this.__data__;if(r instanceof q){var o=r.__data__;if(!At||o.length<199)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new Zt(o)}return r.set(t,e),this.size=r.size,this}function ee(t){var e=this.__data__=new q(t);this.size=e.size}ee.prototype.clear=X,ee.prototype.delete=Y,ee.prototype.get=K,ee.prototype.has=Q,ee.prototype.set=te;var re=ee;function oe(t){return this.__data__.has(t)}function ne(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Zt;++e<r;)this.add(t[e])}ne.prototype.add=ne.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ne.prototype.has=oe;var ie=ne;var ae=function(t,e){for(var r=-1,o=null==t?0:t.length;++r<o;)if(e(t[r],r,t))return!0;return!1};var se=function(t,e){return t.has(e)};var ue=function(t,e,r,o,n,i){var a=1&r,s=t.length,u=e.length;if(s!=u&&!(a&&s<u))return!1;var h=i.get(t);if(h&&i.get(e))return h==e;var l=-1,f=!0,p=2&r?new ie:void 0;for(i.set(t,e),i.set(e,t);++l<s;){var c=t[l],v=e[l];if(o)var y=a?o(v,c,l,e,t,i):o(c,v,l,t,e,i);if(void 0!==y){if(y)continue;f=!1;break}if(p){if(!ae(e,function(t,e){if(!se(p,e)&&(c===t||n(c,t,r,o,i)))return p.push(e)})){f=!1;break}}else if(c!==v&&!n(c,v,r,o,i)){f=!1;break}}return i.delete(t),i.delete(e),f},he=nt.Uint8Array;function le(t){var r=-1,o=Array(t.size);return t.forEach(function(t,e){o[++r]=[e,t]}),o}function fe(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var pe=it?it.prototype:void 0,ce=pe?pe.valueOf:void 0;var ve=function(t,e,r,o,n,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new he(t),new he(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return D(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=le;case"[object Set]":var u=1&o;if(s||(s=fe),t.size!=e.size&&!u)return!1;var h=a.get(t);if(h)return h==e;o|=2,a.set(t,e);var l=ue(s(t),s(e),o,n,i,a);return a.delete(t),l;case"[object Symbol]":if(ce)return ce.call(t)==ce.call(e)}return!1};var ye=function(t,e){for(var r=-1,o=e.length,n=t.length;++r<o;)t[n+r]=e[r];return t},_e=Array.isArray;var de=function(t,e,r){var o=e(t);return _e(t)?o:ye(o,r(t))};var ge=function(t,e){for(var r=-1,o=null==t?0:t.length,n=0,i=[];++r<o;){var a=t[r];e(a,r,t)&&(i[n++]=a)}return i};function be(){return[]}var me=Object.prototype.propertyIsEnumerable,je=Object.getOwnPropertySymbols,Se=je?function(e){return null==e?[]:(e=Object(e),ge(je(e),function(t){return me.call(e,t)}))}:be;var Oe=function(t,e){for(var r=-1,o=Array(t);++r<t;)o[r]=e(r);return o},Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var we=function(t){return null!=t&&"object"==(void 0===t?"undefined":Ee(t))};var ke=function(t){return we(t)&&"[object Arguments]"==vt(t)},Ie=Object.prototype,Ge=Ie.hasOwnProperty,Pe=Ie.propertyIsEnumerable,Te=ke(function(){return arguments}())?ke:function(t){return we(t)&&Ge.call(t,"callee")&&!Pe.call(t,"callee")};function Re(){return!1}var xe=tt(function(t,e){var r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,n=o&&o.exports===r?nt.Buffer:void 0,i=(n?n.isBuffer:void 0)||Re;t.exports=i}),Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze=/^(?:0|[1-9]\d*)$/;var Ce=function(t,e){var r=void 0===t?"undefined":Ae(t);return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ze.test(t))&&-1<t&&t%1==0&&t<e};var Ne=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},Le={};Le["[object Float32Array]"]=Le["[object Float64Array]"]=Le["[object Int8Array]"]=Le["[object Int16Array]"]=Le["[object Int32Array]"]=Le["[object Uint8Array]"]=Le["[object Uint8ClampedArray]"]=Le["[object Uint16Array]"]=Le["[object Uint32Array]"]=!0,Le["[object Arguments]"]=Le["[object Array]"]=Le["[object ArrayBuffer]"]=Le["[object Boolean]"]=Le["[object DataView]"]=Le["[object Date]"]=Le["[object Error]"]=Le["[object Function]"]=Le["[object Map]"]=Le["[object Number]"]=Le["[object Object]"]=Le["[object RegExp]"]=Le["[object Set]"]=Le["[object String]"]=Le["[object WeakMap]"]=!1;function Me(t){return we(t)&&Ne(t.length)&&!!Le[vt(t)]}var Be=function(e){return function(t){return e(t)}},De=tt(function(t,e){var r=e&&!e.nodeType&&e,o=r&&t&&!t.nodeType&&t,n=o&&o.exports===r&&et.process,i=function(){try{var t=o&&o.require&&o.require("util").types;return t||n&&n.binding&&n.binding("util")}catch(t){}}();t.exports=i}),Fe=De&&De.isTypedArray,We=Fe?Be(Fe):Me,Ue=Object.prototype.hasOwnProperty;var Ve=function(t,e){var r=_e(t),o=!r&&Te(t),n=!r&&!o&&xe(t),i=!r&&!o&&!n&&We(t),a=r||o||n||i,s=a?Oe(t.length,String):[],u=s.length;for(var h in t)!e&&!Ue.call(t,h)||a&&("length"==h||n&&("offset"==h||"parent"==h)||i&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||Ce(h,u))||s.push(h);return s},$e=Object.prototype;var He=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$e)};var Je=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),qe=Object.prototype.hasOwnProperty;var Xe=function(t){if(!He(t))return Je(t);var e=[];for(var r in Object(t))qe.call(t,r)&&"constructor"!=r&&e.push(r);return e};var Ye=function(t){return null!=t&&Ne(t.length)&&!gt(t)};function Ke(t){return Ye(t)?Ve(t):Xe(t)}var Qe=function(t){return de(t,Ke,Se)},Ze=Object.prototype.hasOwnProperty;var tr=function(t,e,r,o,n,i){var a=1&r,s=Qe(t),u=s.length;if(u!=Qe(e).length&&!a)return!1;for(var h=u;h--;){var l=s[h];if(!(a?l in e:Ze.call(e,l)))return!1}var f=i.get(t);if(f&&i.get(e))return f==e;var p=!0;i.set(t,e),i.set(e,t);for(var c=a;++h<u;){var v=t[l=s[h]],y=e[l];if(o)var _=a?o(y,v,l,e,t,i):o(v,y,l,t,e,i);if(!(void 0===_?v===y||n(v,y,r,o,i):_)){p=!1;break}c||(c="constructor"==l)}if(p&&!c){var d=t.constructor,g=e.constructor;d!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof d&&d instanceof d&&"function"==typeof g&&g instanceof g)&&(p=!1)}return i.delete(t),i.delete(e),p},er=xt(nt,"DataView"),rr=xt(nt,"Promise"),or=xt(nt,"Set"),nr=xt(nt,"WeakMap"),ir="[object Map]",ar="[object Promise]",sr="[object Set]",ur="[object WeakMap]",hr="[object DataView]",lr=Ot(er),fr=Ot(At),pr=Ot(rr),cr=Ot(or),vr=Ot(nr),yr=vt;(er&&yr(new er(new ArrayBuffer(1)))!=hr||At&&yr(new At)!=ir||rr&&yr(rr.resolve())!=ar||or&&yr(new or)!=sr||nr&&yr(new nr)!=ur)&&(yr=function(t){var e=vt(t),r="[object Object]"==e?t.constructor:void 0,o=r?Ot(r):"";if(o)switch(o){case lr:return hr;case fr:return ir;case pr:return ar;case cr:return sr;case vr:return ur}return e});var _r=yr,dr="[object Arguments]",gr="[object Array]",br="[object Object]",mr=Object.prototype.hasOwnProperty;var jr=function(t,e,r,o,n,i){var a=_e(t),s=_e(e),u=a?gr:_r(t),h=s?gr:_r(e),l=(u=u==dr?br:u)==br,f=(h=h==dr?br:h)==br,p=u==h;if(p&&xe(t)){if(!xe(e))return!1;l=!(a=!0)}if(p&&!l)return i||(i=new re),a||We(t)?ue(t,e,r,o,n,i):ve(t,e,u,r,o,n,i);if(!(1&r)){var c=l&&mr.call(t,"__wrapped__"),v=f&&mr.call(e,"__wrapped__");if(c||v){var y=c?t.value():t,_=v?e.value():e;return i||(i=new re),n(y,_,r,o,i)}}return p&&(i||(i=new re),tr(t,e,r,o,n,i))};var Sr=function t(e,r,o,n,i){return e===r||(null==e||null==r||!we(e)&&!we(r)?e!=e&&r!=r:jr(e,r,o,n,t,i))};var Or=function(t,e){return Sr(t,e)};function Er(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),o=0;o<r.length;o++){var n=r[o],i=Object.getOwnPropertyDescriptor(e,n);i&&i.configurable&&void 0===t[n]&&Object.defineProperty(t,n,i)}}(t,e))}var wr,kr=(Er(Ir,wr=maptalks.Class),Ir.prototype.intersection=function(t,e){return this._setTaskSafety("intersection"),this._initialTask(t,e)},Ir.prototype.union=function(t,e){return this._setTaskSafety("union"),this._initialTask(t,e)},Ir.prototype.diff=function(t,e){return this._setTaskSafety("diff"),this._initialTask(t,e)},Ir.prototype.xor=function(t,e){return this._setTaskSafety("xor"),this._initialTask(t,e)},Ir.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};this._dealWithTargets(),t(this._result,this._deals),this.remove()},Ir.prototype.cancel=function(){this.remove()},Ir.prototype.remove=function(){this._map,this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._chooseLayer,delete this._mousemove,delete this._click},Ir.prototype._setTaskSafety=function(t){this.geometry&&this.remove(),this._task=t},Ir.prototype._initialTask=function(t,e){if(this._checkAvailGeoType(t))if(void 0===e)this._savePrivateGeometry(t),this._chooseGeos=[t],this._updateChooseGeos();else if(this.geometry=t,this._checkAvailGeoType(e)&&(e=[e]),e instanceof Array&&0<e.length?this._dealWithTargets(e):this._result=t.copy(),this._result){var r=this._result;return this.remove(),r}},Ir.prototype._checkAvailGeoType=function(t){return t instanceof maptalks.Polygon||t instanceof maptalks.MultiPolygon},Ir.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},Ir.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),t._map_tool&&t._map_tool instanceof maptalks.DrawTool&&t._map_tool.disable(),this._map=t,this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},Ir.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},Ir.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},Ir.prototype._mousemoveEvents=function(t){var r=this,o=[],n=this._getSafeCoords();t.target.identify({coordinate:t.coordinate,tolerance:1e-4,layers:[this.layer.getId()].concat(this.options.alterNative)},function(t){return t.forEach(function(t){var e=r._getSafeCoords(t);!Or(e,n)&&r._checkAvailGeoType(t)&&o.push(t)})}),this._updateHitGeo(o)},Ir.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var r=t.options,o=r.numberOfShellPoints;r.numberOfShellPoints=300,t.setOptions(r),e=[t.getShell()],r.numberOfShellPoints=o||60,t.setOptions(r)}return e},Ir.prototype._updateHitGeo=function(t){if(this._needRefreshSymbol){var e=this._chooseLayer.getGeometryById("_hit");e&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length){this._needRefreshSymbol=!0,this.hitGeo=t[0];var r=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,r).setId("_hit")}},Ir.prototype._getSymbolOrDefault=function(t,e){var r=t.getSymbol(),o=this["_color"+e];if(r){for(var n in r)(n.endsWith("Fill")||n.endsWith("Color"))&&(r[n]=o);r.lineWidth=4}else r={lineColor:o,lineWidth:4};return r},Ir.prototype._copyGeoUpdateSymbol=function(t,e){var r=this._getSafeCoords(t);return(t instanceof maptalks.Polygon?new maptalks.Polygon(r):new maptalks.MultiPolygon(r)).updateSymbol(e).addTo(this._chooseLayer)},Ir.prototype._clickEvents=function(t){if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}},Ir.prototype._setChooseGeosExceptHit=function(r,t){var o=this,n=[];this._chooseGeos.forEach(function(t){var e=o._getSafeCoords(t);Or(r,e)||n.push(t)}),t||n.length!==this._chooseGeos.length?this._chooseGeos=n:this._chooseGeos.push(this.hitGeo)},Ir.prototype._updateChooseGeos=function(){var r=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=r._getSymbolOrDefault(t,"Choose");r._copyGeoUpdateSymbol(t,e)})},Ir.prototype._dealWithTargets=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,r=void 0;this._deals=[],t.forEach(function(t){null!==r&&(r=r?e._getBoolResultGeo(t,r):e._getBoolResultGeo(t)),e._deals.push(t.copy())}),this._result=r},Ir.prototype._getBoolResultGeo=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.geometry,r=this._getGeoJSONCoords(e),o=this._getGeoJSONCoords(t);if(!this.options.includeSame&&Or(r,o))return e;var n=void 0;try{n=M(r,o,this._getBoolType())}catch(t){}var i=this.geometry.getSymbol(),a=this.geometry.getProperties();return n?1===n.length?new maptalks.Polygon(n[0],{symbol:i,properties:a}):new maptalks.MultiPolygon(n,{symbol:i,properties:a}):null},Ir.prototype._getGeoJSONCoords=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry).toGeoJSON().geometry.coordinates},Ir.prototype._getBoolType=function(){return{intersection:0,union:1,diff:2,xor:3}[this._task]},Ir);function Ir(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ir);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,wr.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}kr.mergeOptions({includeSame:!0,alterNative:[]}),t.PolygonBool=kr,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.polygonbool v0.1.0-beta.1")});