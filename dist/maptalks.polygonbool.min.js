/*!
 * maptalks.polygonbool v0.1.0-beta.2
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e){return e<t?1:t<e?-1:0}var y=(i.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},i.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},i.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},i.prototype.splay=function(t){for(var e,r,n,o,i;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),o=t.left,i=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,(e.right=r).parent=e):(o?(r.right=o).parent=r:r.right=null,(t.left=r).parent=t)),i?(e.left=i).parent=e:e.left=null,(t.right=e).parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,(e.left=r).parent=e):(i?(r.left=i).parent=r:r.left=null,(t.right=r).parent=t)),o?(e.right=o).parent=e:e.right=null,(t.left=e).parent=t)},i.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},i.prototype.minNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t},i.prototype.insert=function(t,e){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(0===o((n=r).key,t))return;r=o(r.key,t)<0?r.right:r.left}else for(;r;)r=o((n=r).key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},i.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(0<n))return e;e=e.left}}return null},i.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},i.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},i.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},i.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}},i.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},i.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},i.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},i.prototype.forEach=function(t){for(var e=this._root,r=[],n=!1,o=0;!n;)e?(r.push(e),e=e.left):0<r.length?(t(e=r.pop(),o++),e=e.right):n=!0;return this},i.prototype.range=function(t,e,r,n){for(var o=[],i=this._compare,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(0<i((s=o.pop()).key,e))break;if(0<=i(s.key,t)&&r.call(n,s))return this;s=s.right}return this},i.prototype.keys=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r},i.prototype.values=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r},i.prototype.at=function(t){for(var e=this._root,r=[],n=!1,o=0;!n;)if(e)r.push(e),e=e.left;else if(0<r.length){if(e=r.pop(),o===t)return e;o++,e=e.right}else n=!0;return null},i.prototype.load=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var n=t.length;return r&&function t(e,r,n,o,i){if(!(o<=n)){for(var s=e[n+o>>1],a=n-1,u=o+1;;){for(;i(e[++a],s)<0;);for(;0<i(e[--u],s););if(u<=a)break;var h=e[a];e[a]=e[u],e[u]=h,h=r[a],r[a]=r[u],r[u]=h}t(e,r,n,u,i),t(e,r,u+1,o,i)}}(t,e,0,n-1,this._compare),this._root=function t(e,r,n,o,i){var s=i-o;if(0<s){var a=o+Math.floor(s/2),u=r[a],h=n[a],l={key:u,data:h,parent:e};return l.left=t(l,r,n,o,a),l.right=t(l,r,n,a+1,i),l}return null}(null,t,e,0,n),this._size=n,this},i.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},i.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},i.prototype.isEmpty=function(){return null===this._root},i.createTree=function(t,e,r,n,o){return new i(r,o).load(t,e,n)},e(i,[{key:"size",get:function(){return this._size}}]),i);function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}var s=0,u=1,h=2,l=3,_=0,a=1,d=2,f=3;function g(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!o(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=o(t,r)}function o(t,e){switch(t.type){case s:switch(e){case _:return!t.otherInOut;case a:return t.otherInOut;case d:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case f:return!0}break;case h:return e===_||e===a;case l:return e===d;case u:return!1}return!1}var v=(p.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]):0<(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])},p.prototype.isAbove=function(t){return!this.isBelow(t)},p.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},p.prototype.clone=function(){var t=new p(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},p);function p(t,e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=o||s,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}function c(t,e){return t[0]===e[0]&&t[1]===e[1]}function b(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function m(t,e){var r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r,n){return t.left!==e.left?t.left?1:-1:0===b(r,t.otherEvent.point,e.otherEvent.point)?!t.isSubject&&e.isSubject?1:-1:t.isBelow(e.otherEvent.point)?-1:1}(t,e,r)}function E(t,e,r){var n=new v(e,!1,t,t.isSubject),o=new v(e,!0,t.otherEvent,t.isSubject);return c(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=o.contourId=t.contourId,0<m(o,t.otherEvent)&&(t.otherEvent.left=!0,o.left=!1),t.otherEvent.otherEvent=o,t.otherEvent=n,r.push(o),r.push(n),r}function k(t,e){return t[0]*e[1]-t[1]*e[0]}function O(t,e){return t[0]*e[0]+t[1]*e[1]}var j=function(t,e,r,n,o){var i=[e[0]-t[0],e[1]-t[1]],s=[n[0]-r[0],n[1]-r[1]];function a(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}var u=[r[0]-t[0],r[1]-t[1]],h=k(i,s),l=h*h,f=O(i,i);if(0<l){var p=k(u,s)/h;if(p<0||1<p)return null;var c=k(u,i)/h;return c<0||1<c?null:0==p||1==p?o?null:[a(t,p,i)]:0==c||1==c?o?null:[a(r,c,s)]:[a(t,p,i)]}if(0<(l=(h=k(u,i))*h))return null;var v=O(i,u)/f,y=v+O(i,s)/f,_=Math.min(v,y),d=Math.max(v,y);return _<=1&&0<=d?1===_?o?null:[a(t,0<_?_:0,i)]:0===d?o?null:[a(t,d<1?d:1,i)]:o&&0===_&&1===d?null:[a(t,0<_?_:0,i),a(t,d<1?d:1,i)]:null};function w(t,e,r){var n=j(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(c(t.point,e.point)||c(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return c(t.point,n[0])||c(t.otherEvent.point,n[0])||E(t,n[0],r),c(e.point,n[0])||c(e.otherEvent.point,n[0])||E(e,n[0],r),1;var i=[],s=!1,a=!1;return c(t.point,e.point)?s=!0:1===m(t,e)?i.push(e,t):i.push(t,e),c(t.otherEvent.point,e.otherEvent.point)?a=!0:1===m(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),s&&a||s?(e.type=u,t.type=e.inOut===t.inOut?h:l,s&&!a&&E(i[1].otherEvent,i[0].point,r),2):(a?E(i[0],i[1].point,r):i[0]!==i[3].otherEvent?(E(i[0],i[1].point,r),E(i[1],i[2].point,r)):(E(i[0],i[1].point,r),E(i[3].otherEvent,i[2].point,r)),3)}function S(t,e){if(t===e)return 0;if(0!==b(t.point,t.otherEvent.point,e.point)||0!==b(t.point,t.otherEvent.point,e.otherEvent.point))return c(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===m(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,n=e.point;return r[0]===n[0]&&r[1]===n[1]?(r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1):1===m(t,e)?1:-1}function G(t,e,r,n){var o,i=void 0,s=t+1,a=e.length;for(o=e[t].point,s<a&&(i=e[s].point);s<a&&i[0]===o[0]&&i[1]===o[1];){if(!r[s])return s;i=e[++s].point}for(s=t-1;r[s]&&n<=s;)s--;return s}function I(t,e){var r,n=void 0,o=function(t){var e=void 0,r=void 0,n=void 0,o=void 0,i=[];for(r=0,n=t.length;r<n;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);for(var s=!1;!s;)for(s=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===m(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,s=!1);for(r=0,n=i.length;r<n;r++)(e=i[r]).pos=r;for(r=0,n=i.length;r<n;r++)(e=i[r]).left||(o=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=o);return i}(t),i={},s=[],a=void 0;for(n=0,r=o.length;n<r;n++)if(!i[n]){var u=[[]];o[n].isExteriorRing?e===d&&!o[n].isSubject&&1<s.length?s[s.length-1].push(u[0]):s.push(u):e!==d||o[n].isSubject||0!==s.length?0===s.length?s.push([[u]]):s[s.length-1].push(u[0]):s.push(u);var h=s.length-1,l=n,f=o[n].point;for(u[0].push(f);n<=l;)a=o[l],i[l]=!0,a.left?(a.resultInOut=!1,a.contourId=h):(a.otherEvent.resultInOut=!0,a.otherEvent.contourId=h),i[l=a.pos]=!0,u[0].push(o[l].point),l=G(l,o,i,n);a=o[l=-1===l?n:l],i[l]=i[a.pos]=!0,a.otherEvent.resultInOut=!0,a.otherEvent.contourId=h}return s}var x=T,R=T;function T(t,e){if(!(this instanceof T))return new T(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||z,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function z(t,e){return t<e?-1:e<t?1:0}T.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var o=t-1>>1,i=e[o];if(0<=r(n,i))break;e[t]=i,t=o}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,o=e[t];t<n;){var i=1+(t<<1),s=i+1,a=e[i];if(s<this.length&&r(e[s],a)<0&&(a=e[i=s]),0<=r(a,o))break;e[t]=a,t=i}e[t]=o}},x.default=R;var A=Math.max,P=Math.min,L=0;function C(t,e,r,n,o,i){var s,a=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(a=0,s=t.length-1;a<s;a++)if(u=t[a],h=t[a+1],l=new v(u,!1,void 0,e),f=new v(h,!1,l,e),l.otherEvent=f,u[0]!==h[0]||u[1]!==h[1]){l.contourId=f.contourId=r,i||(l.isExteriorRing=!1,f.isExteriorRing=!1),0<m(l,f)?f.left=!0:l.left=!0;var p=u[0],c=u[1];o[0]=P(o[0],p),o[1]=P(o[1],c),o[2]=A(o[2],p),o[3]=A(o[3],c),n.push(l),n.push(f)}}var N=[];function M(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var n=function(t,e,r){var n=null;return t.length*e.length==0&&(r===_?n=N:r===d?n=t:r!==a&&r!==f||(n=0===t.length?e:t)),n}(t,e,r);if(n)return n===N?null:n;var o=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],s=function(t,e,r,n,o){var i=new x(null,m),s=void 0,a=void 0,u=void 0,h=void 0,l=void 0,f=void 0;for(u=0,h=t.length;u<h;u++)for(l=0,f=(s=t[u]).length;l<f;l++)(a=0===l)&&L++,C(s[l],!0,L,i,r,a);for(u=0,h=e.length;u<h;u++)for(l=0,f=(s=e[u]).length;l<f;l++)a=0===l,o===d&&(a=!1),a&&L++,C(s[l],!1,L,i,n,a);return i}(t,e,o,i,r);return(n=function(t,e,r,n,o){var i=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(o===_?i=N:o===d?i=t:o!==a&&o!==f||(i=t.concat(e))),i}(t,e,o,i,r))?n===N?null:n:I(function(t,e,r,n,o,i){for(var s=new y(S),a=[],u=Math.min(n[2],o[2]),h=void 0,l=void 0,f=void 0;0!==t.length;){var p=t.pop();if(a.push(p),i===_&&p.point[0]>u||i===d&&p.point[0]>n[2])break;if(p.left){l=h=s.insert(p),h=h!==(f=s.minNode())?s.prev(h):null,l=s.next(l);var c=h?h.key:null;if(g(p,c,i),l&&2===w(p,l.key,t)&&(g(p,c,i),g(p,l.key,i)),h&&2===w(h.key,p,t)){var v=h;g(c,(v=v!==f?s.prev(v):null)?v.key:null,i),g(p,c,i)}}else p=p.otherEvent,l=h=s.find(p),h&&l&&(h=h!==f?s.prev(h):null,l=s.next(l),s.remove(p),l&&h&&w(h.key,l.key,t))}return a}(s,0,0,o,i,r),r)}var te="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var B,ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U=(function(t,e){var n="__lodash_hash_undefined__",m=1,d=2,r=9007199254740991,g="[object Arguments]",b="[object Array]",o="[object AsyncFunction]",E="[object Boolean]",k="[object Date]",O="[object Error]",i="[object Function]",s="[object GeneratorFunction]",j="[object Map]",w="[object Number]",a="[object Null]",S="[object Object]",u="[object Promise]",h="[object Proxy]",G="[object RegExp]",I="[object Set]",x="[object String]",R="[object Symbol]",l="[object Undefined]",f="[object WeakMap]",T="[object ArrayBuffer]",z="[object DataView]",p=/^\[object .+?Constructor\]$/,c=/^(?:0|[1-9]\d*)$/,v={};v["[object Float32Array]"]=v["[object Float64Array]"]=v["[object Int8Array]"]=v["[object Int16Array]"]=v["[object Int32Array]"]=v["[object Uint8Array]"]=v["[object Uint8ClampedArray]"]=v["[object Uint16Array]"]=v["[object Uint32Array]"]=!0,v[g]=v[b]=v[T]=v[E]=v[z]=v[k]=v[O]=v[i]=v[j]=v[w]=v[S]=v[G]=v[I]=v[x]=v[f]=!1;var y="object"==ee(te)&&te&&te.Object===Object&&te,_="object"==("undefined"==typeof self?"undefined":ee(self))&&self&&self.Object===Object&&self,A=y||_||Function("return this")(),P=e&&!e.nodeType&&e,L=P&&t&&!t.nodeType&&t,C=L&&L.exports===P,N=C&&y.process,M=function(){try{return N&&N.binding&&N.binding("util")}catch(t){}}(),B=M&&M.isTypedArray;function U(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function D(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function F(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var W,$,H,V=Array.prototype,J=Function.prototype,Y=Object.prototype,X=A["__core-js_shared__"],q=J.toString,K=Y.hasOwnProperty,Q=(W=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",Z=Y.toString,tt=RegExp("^"+q.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=C?A.Buffer:void 0,rt=A.Symbol,nt=A.Uint8Array,ot=Y.propertyIsEnumerable,it=V.splice,st=rt?rt.toStringTag:void 0,at=Object.getOwnPropertySymbols,ut=et?et.isBuffer:void 0,ht=($=Object.keys,H=Object,function(t){return $(H(t))}),lt=Mt(A,"DataView"),ft=Mt(A,"Map"),pt=Mt(A,"Promise"),ct=Mt(A,"Set"),vt=Mt(A,"WeakMap"),yt=Mt(Object,"create"),_t=Ft(lt),dt=Ft(ft),gt=Ft(pt),bt=Ft(ct),mt=Ft(vt),Et=rt?rt.prototype:void 0,kt=Et?Et.valueOf:void 0;function Ot(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function wt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function St(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new wt;++e<r;)this.add(t[e])}function Gt(t){var e=this.__data__=new jt(t);this.size=e.size}function It(t,e){var r=Ht(t),n=!r&&$t(t),o=!r&&!n&&Vt(t),i=!r&&!n&&!o&&Qt(t),s=r||n||o||i,a=s?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=a.length;for(var h in t)!e&&!K.call(t,h)||s&&("length"==h||o&&("offset"==h||"parent"==h)||i&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||Dt(h,u))||a.push(h);return a}function xt(t,e){for(var r=t.length;r--;)if(Wt(t[r][0],e))return r;return-1}function Rt(t){return null==t?void 0===t?l:a:st&&st in Object(t)?function(t){var e=K.call(t,st),r=t[st];try{var n=!(t[st]=void 0)}catch(t){}var o=Z.call(t);n&&(e?t[st]=r:delete t[st]);return o}(t):function(t){return Z.call(t)}(t)}function Tt(t){return qt(t)&&Rt(t)==g}function zt(t,e,r,n,o){return t===e||(null==t||null==e||!qt(t)&&!qt(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var s=Ht(t),a=Ht(e),u=s?b:Ut(t),h=a?b:Ut(e),l=(u=u==g?S:u)==S,f=(h=h==g?S:h)==S,p=u==h;if(p&&Vt(t)){if(!Vt(e))return!1;l=!(s=!0)}if(p&&!l)return i||(i=new Gt),s||Qt(t)?Lt(t,e,r,n,o,i):function(t,e,r,n,o,i,s){switch(r){case z:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case T:return!(t.byteLength!=e.byteLength||!i(new nt(t),new nt(e)));case E:case k:case w:return Wt(+t,+e);case O:return t.name==e.name&&t.message==e.message;case G:case x:return t==e+"";case j:var a=D;case I:var u=n&m;if(a||(a=F),t.size!=e.size&&!u)return!1;var h=s.get(t);if(h)return h==e;n|=d,s.set(t,e);var l=Lt(a(t),a(e),n,o,i,s);return s.delete(t),l;case R:if(kt)return kt.call(t)==kt.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&m)){var c=l&&K.call(t,"__wrapped__"),v=f&&K.call(e,"__wrapped__");if(c||v){var y=c?t.value():t,_=v?e.value():e;return i||(i=new Gt),o(y,_,r,n,i)}}return p&&(i||(i=new Gt),function(t,e,r,n,o,i){var s=r&m,a=Ct(t),u=a.length,h=Ct(e).length;if(u!=h&&!s)return!1;for(var l=u;l--;){var f=a[l];if(!(s?f in e:K.call(e,f)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var c=!0;i.set(t,e),i.set(e,t);for(var v=s;++l<u;){f=a[l];var y=t[f],_=e[f];if(n)var d=s?n(_,y,f,e,t,i):n(y,_,f,t,e,i);if(!(void 0===d?y===_||o(y,_,r,n,i):d)){c=!1;break}v||(v="constructor"==f)}if(c&&!v){var g=t.constructor,b=e.constructor;g!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(c=!1)}return i.delete(t),i.delete(e),c}(t,e,r,n,o,i))}(t,e,r,n,zt,o))}function At(t){return!(!Xt(t)||function(t){return!!Q&&Q in t}(t))&&(Jt(t)?tt:p).test(Ft(t))}function Pt(t){if(!function(t){var e=t&&t.constructor,r="function"==typeof e&&e.prototype||Y;return t===r}(t))return ht(t);var e=[];for(var r in Object(t))K.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Lt(t,e,n,o,i,s){var r=n&m,a=t.length,u=e.length;if(a!=u&&!(r&&a<u))return!1;var h=s.get(t);if(h&&s.get(e))return h==e;var l=-1,f=!0,p=n&d?new St:void 0;for(s.set(t,e),s.set(e,t);++l<a;){var c=t[l],v=e[l];if(o)var y=r?o(v,c,l,e,t,s):o(c,v,l,t,e,s);if(void 0!==y){if(y)continue;f=!1;break}if(p){if(!U(e,function(t,e){if(r=e,!p.has(r)&&(c===t||i(c,t,n,o,s)))return p.push(e);var r})){f=!1;break}}else if(c!==v&&!i(c,v,n,o,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Ct(t){return function(t,e,r){var n=e(t);return Ht(t)?n:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(n,r(t))}(t,Zt,Bt)}function Nt(t,e){var r=t.__data__;return function(t){var e=void 0===t?"undefined":ee(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?r["string"==typeof e?"string":"hash"]:r.map}function Mt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return At(r)?r:void 0}Ot.prototype.clear=function(){this.__data__=yt?yt(null):{},this.size=0},Ot.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ot.prototype.get=function(t){var e=this.__data__;if(yt){var r=e[t];return r===n?void 0:r}return K.call(e,t)?e[t]:void 0},Ot.prototype.has=function(t){var e=this.__data__;return yt?void 0!==e[t]:K.call(e,t)},Ot.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=yt&&void 0===e?n:e,this},jt.prototype.clear=function(){this.__data__=[],this.size=0},jt.prototype.delete=function(t){var e=this.__data__,r=xt(e,t);return!(r<0||(r==e.length-1?e.pop():it.call(e,r,1),--this.size,0))},jt.prototype.get=function(t){var e=this.__data__,r=xt(e,t);return r<0?void 0:e[r][1]},jt.prototype.has=function(t){return-1<xt(this.__data__,t)},jt.prototype.set=function(t,e){var r=this.__data__,n=xt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},wt.prototype.clear=function(){this.size=0,this.__data__={hash:new Ot,map:new(ft||jt),string:new Ot}},wt.prototype.delete=function(t){var e=Nt(this,t).delete(t);return this.size-=e?1:0,e},wt.prototype.get=function(t){return Nt(this,t).get(t)},wt.prototype.has=function(t){return Nt(this,t).has(t)},wt.prototype.set=function(t,e){var r=Nt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},St.prototype.add=St.prototype.push=function(t){return this.__data__.set(t,n),this},St.prototype.has=function(t){return this.__data__.has(t)},Gt.prototype.clear=function(){this.__data__=new jt,this.size=0},Gt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},Gt.prototype.get=function(t){return this.__data__.get(t)},Gt.prototype.has=function(t){return this.__data__.has(t)},Gt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof jt){var n=r.__data__;if(!ft||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new wt(n)}return r.set(t,e),this.size=r.size,this};var Bt=at?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i}(at(e),function(t){return ot.call(e,t)}))}:function(){return[]},Ut=Rt;function Dt(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||c.test(t))&&-1<t&&t%1==0&&t<e}function Ft(t){if(null!=t){try{return q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Wt(t,e){return t===e||t!=t&&e!=e}(lt&&Ut(new lt(new ArrayBuffer(1)))!=z||ft&&Ut(new ft)!=j||pt&&Ut(pt.resolve())!=u||ct&&Ut(new ct)!=I||vt&&Ut(new vt)!=f)&&(Ut=function(t){var e=Rt(t),r=e==S?t.constructor:void 0,n=r?Ft(r):"";if(n)switch(n){case _t:return z;case dt:return j;case gt:return u;case bt:return I;case mt:return f}return e});var $t=Tt(function(){return arguments}())?Tt:function(t){return qt(t)&&K.call(t,"callee")&&!ot.call(t,"callee")},Ht=Array.isArray;var Vt=ut||function(){return!1};function Jt(t){if(!Xt(t))return!1;var e=Rt(t);return e==i||e==s||e==o||e==h}function Yt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=r}function Xt(t){var e=void 0===t?"undefined":ee(t);return null!=t&&("object"==e||"function"==e)}function qt(t){return null!=t&&"object"==(void 0===t?"undefined":ee(t))}var Kt,Qt=B?(Kt=B,function(t){return Kt(t)}):function(t){return qt(t)&&Yt(t.length)&&!!v[Rt(t)]};function Zt(t){return function(t){return null!=t&&Yt(t.length)&&!Jt(t)}(t)?It(t):Pt(t)}t.exports=function(t,e){return zt(t,e)}}(B={exports:{}},B.exports),B.exports);var D=function(t){var e=t?t.length:0;return e?function(t,e,r){var n=-1,o=t.length;e<0&&(e=o<-e?0:o+e),(r=o<r?o:r)<0&&(r+=o),o=r<e?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i}(t,1,e):[]};function F(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var W,$=(F(H,W=maptalks.Class),H.prototype.intersection=function(t,e){return this._setTaskSafety("intersection"),this._initialTask(t,e)},H.prototype.union=function(t,e){return this._setTaskSafety("union"),this._initialTask(t,e)},H.prototype.diff=function(t,e){return this._setTaskSafety("diff"),this._initialTask(t,e)},H.prototype.xor=function(t,e){return this._setTaskSafety("xor"),this._initialTask(t,e)},H.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},e=D(this._chooseGeos);return t(this._dealWithTargets(e),this._deals),this.remove(),this},H.prototype.cancel=function(){return this.remove(),this},H.prototype.remove=function(){return this._map,this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._chooseLayer,delete this._mousemove,delete this._click,this},H.prototype._setTaskSafety=function(t){this.geometry&&this.remove(),this._boolType=["intersection","union","diff","xor"].indexOf(t)},H.prototype._initialTask=function(t,e){if(this._checkAvailGeoType(t)){if(void 0!==e){this.geometry=t,this._checkAvailGeoType(e)&&(e=[e]);var r=t.copy();return e instanceof Array&&0<e.length&&(r=this._dealWithTargets(e)),this.remove(),r}this._savePrivateGeometry(t),this._chooseGeos=[t],this._updateChooseGeos()}},H.prototype._checkAvailGeoType=function(t){return t instanceof maptalks.Polygon||t instanceof maptalks.MultiPolygon},H.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t.getLayer(),this._addTo(t.getMap())},H.prototype._addTo=function(t){this._chooseLayer&&this.remove(),t._map_tool&&t._map_tool instanceof maptalks.DrawTool&&t._map_tool.disable(),this._map=t,this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents()},H.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},H.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},H.prototype._mousemoveEvents=function(t){var r=this,n=[],o=this._getSafeCoords();t.target.identify({coordinate:t.coordinate,tolerance:1e-4,layers:[this.layer.getId()].concat(this.options.alterNative)},function(t){return t.forEach(function(t){var e=r._getSafeCoords(t);!U(e,o)&&r._checkAvailGeoType(t)&&n.push(t)})}),this._updateHitGeo(n)},H.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var r=t.options,n=r.numberOfShellPoints;r.numberOfShellPoints=300,t.setOptions(r),e=[t.getShell()],r.numberOfShellPoints=n||60,t.setOptions(r)}return e},H.prototype._updateHitGeo=function(t){if(this._needRefreshSymbol){var e=this._chooseLayer.getGeometryById("_hit");e&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length){this._needRefreshSymbol=!0,this.hitGeo=t[0];var r=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,r).setId("_hit")}},H.prototype._getSymbolOrDefault=function(t,e){var r=t.getSymbol(),n=this["_color"+e];if(r){for(var o in r)(o.endsWith("Fill")||o.endsWith("Color"))&&(r[o]=n);r.lineWidth=4}else r={lineColor:n,lineWidth:4};return r},H.prototype._copyGeoUpdateSymbol=function(t,e){var r=this._getSafeCoords(t);return(t instanceof maptalks.Polygon?new maptalks.Polygon(r):new maptalks.MultiPolygon(r)).updateSymbol(e).addTo(this._chooseLayer)},H.prototype._clickEvents=function(t){if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}},H.prototype._setChooseGeosExceptHit=function(o){var i=this,t=this._chooseGeos.reduce(function(t,e,r){var n=i._getSafeCoords(e);return 0<r&&U(o,n)||t.push(e),t},[]);t.length===this._chooseGeos.length?this._chooseGeos.push(this.hitGeo):this._chooseGeos=t},H.prototype._updateChooseGeos=function(){var r=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=r._getSymbolOrDefault(t,"Choose");r._copyGeoUpdateSymbol(t,e)})},H.prototype._dealWithTargets=function(t){var e=this,r=void 0;if(this._deals=t.map(function(t){return null!==r&&(r=r?e._getBoolResultGeo(t,r):e._getBoolResultGeo(t)),t.copy()}),r)return r.setSymbol(this.geometry.getSymbol()),r.setProperties(this.geometry.getProperties()),r},H.prototype._getBoolResultGeo=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.geometry,r=this._getGeoJSONCoords(e),n=this._getGeoJSONCoords(t);if(!this.options.includeSame&&U(r,n))return e;var o=void 0;try{o=M(r,n,this._boolType)}catch(t){}return(o=this._removeUnexpectedLine(o))?1===o.length?new maptalks.Polygon(o[0]):new maptalks.MultiPolygon(o):null},H.prototype._getGeoJSONCoords=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry).toGeoJSON().geometry.coordinates},H.prototype._removeUnexpectedLine=function(t){var e=t.reduce(function(t,e){var r=e.reduce(function(t,e){return 3<e.length&&t.push(e),t},[]);return 0<r.length&&t.push(r),t},[]);return 0===e.length?null:e},H);function H(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,H);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,W.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_POLYGONBOOL",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}$.mergeOptions({includeSame:!0,alterNative:[]}),t.PolygonBool=$,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.polygonbool v0.1.0-beta.2")});