/*!
 * maptalks.polygonbool v0.1.0-alpha.1
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function n(t,e){return e<t?1:t<e?-1:0}!function(){function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}o.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},o.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},o.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},o.prototype.splay=function(t){for(var e,n,r,i,o;t.parent;)(n=(e=t.parent).parent)&&n.parent?((r=n.parent).left===n?r.left=t:r.right=t,t.parent=r):(t.parent=null,this._root=t),i=t.left,o=t.right,t===e.left?(n&&(n.left===e?(e.right?(n.left=e.right,n.left.parent=n):n.left=null,(e.right=n).parent=e):(i?(n.right=i).parent=n:n.right=null,(t.left=n).parent=t)),o?(e.left=o).parent=e:e.left=null,(t.right=e).parent=t):(n&&(n.right===e?(e.left?(n.right=e.left,n.right.parent=n):n.right=null,(e.left=n).parent=e):(o?(n.left=o).parent=n:n.left=null,(t.right=n).parent=t)),i?(e.right=i).parent=e:e.right=null,(t.left=e).parent=t)},o.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},o.prototype.minNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t},o.prototype.maxNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t},o.prototype.insert=function(t,e){var n=this._root,r=null,i=this._compare;if(this._noDuplicates)for(;n;){if(0===i((r=n).key,t))return;n=i(n.key,t)<0?n.right:n.left}else for(;n;)n=i((r=n).key,t)<0?n.right:n.left;return n={key:t,data:e,left:null,right:null,parent:r},r?i(r.key,n.key)<0?r.right=n:r.left=n:this._root=n,this.splay(n),this._size++,n},o.prototype.find=function(t){for(var e=this._root,n=this._compare;e;){var r=n(e.key,t);if(r<0)e=e.right;else{if(!(0<r))return e;e=e.left}}return null},o.prototype.contains=function(t){for(var e=this._root,n=this._compare;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},o.prototype.remove=function(t){var e=this.find(t);if(!e)return!1;if(this.splay(e),e.left)if(e.right){var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},o.prototype.removeNode=function(t){if(!t)return!1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},o.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var n=e.left,r=e.right,i=null;n&&(n.parent=null,i=this.maxNode(n),this.splay(i),this._root=i),r&&(n?i.right=r:this._root=r,r.parent=i),this._size--}},o.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},o.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},o.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},o.prototype.forEach=function(t){for(var e=this._root,n=[],r=!1,i=0;!r;)e?(n.push(e),e=e.left):0<n.length?(t(e=n.pop(),i++),e=e.right):r=!0;return this},o.prototype.range=function(t,e,n,r){for(var i=[],o=this._compare,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(0<o((s=i.pop()).key,e))break;if(0<=o(s.key,t)&&n.call(r,s))return this;s=s.right}return this},o.prototype.keys=function(){for(var t=this._root,e=[],n=[],r=!1;!r;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),n.push(t.key),t=t.right):r=!0;return n},o.prototype.values=function(){for(var t=this._root,e=[],n=[],r=!1;!r;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),n.push(t.data),t=t.right):r=!0;return n},o.prototype.at=function(t){for(var e=this._root,n=[],r=!1,i=0;!r;)if(e)n.push(e),e=e.left;else if(0<n.length){if(e=n.pop(),i===t)return e;i++,e=e.right}else r=!0;return null},o.prototype.load=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var r=t.length;return n&&function t(e,n,r,i,o){if(i<=r)return;var s=e[r+i>>1];var a=r-1;var u=i+1;for(;;){for(;o(e[++a],s)<0;);for(;0<o(e[--u],s););if(u<=a)break;var h=e[a];e[a]=e[u],e[u]=h,h=n[a],n[a]=n[u],n[u]=h}t(e,n,r,u,o);t(e,n,u+1,i,o)}(t,e,0,r-1,this._compare),this._root=function t(e,n,r,i,o){var s=o-i;if(0<s){var a=i+Math.floor(s/2),u=n[a],h=r[a],c={key:u,data:h,parent:e};return c.left=t(c,n,r,i,a),c.right=t(c,n,r,a+1,o),c}return null}(null,t,e,0,r),this._size=r,this},o.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},o.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},o.prototype.isEmpty=function(){return null===this._root},o.createTree=function(t,e,n,r,i){return new o(n,i).load(t,e,r)},e(o,[{key:"size",get:function(){return this._size}}])}();!function(){function o(t,e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.left=e,this.point=t,this.otherEvent=n,this.isSubject=r,this.type=i||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}o.prototype.isBelow=function(t){var e=this.point,n=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]):0<(n[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(n[1]-t[1])},o.prototype.isAbove=function(t){return!this.isBelow(t)},o.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},o.prototype.clone=function(){var t=new o(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t}}();var r=s,o=s;function s(t,e){if(!(this instanceof s))return new s(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||a,0<this.length)for(var n=(this.length>>1)-1;0<=n;n--)this._down(n)}function a(t,e){return t<e?-1:e<t?1:0}s.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];0<t;){var i=t-1>>1,o=e[i];if(0<=n(r,o))break;e[t]=o,t=i}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&n(e[s],a)<0&&(a=e[o=s]),0<=n(a,i))break;e[t]=a,t=o}e[t]=i}},r.default=o;Math.max,Math.min;var u="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t,e){return t(e={exports:{}},e.exports),e.exports}var c={Point2D:h(function(t){function e(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}e.prototype.clone=function(){return new this.constructor(this.x,this.y)},e.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},e.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},e.prototype.lerp=function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)},e.prototype.distanceFrom=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},e.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},e.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},e.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},e.prototype.toString=function(){return"point("+this.x+","+this.y+")"},t.exports=e}),Vector2D:h(function(t){function n(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}n.fromPoints=function(t,e){return new n(e.x-t.x,e.y-t.y)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},n.prototype.unit=function(){return this.divide(this.length())},n.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},n.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},n.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},n.prototype.angleBetween=function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n},n.prototype.perp=function(){return new this.constructor(-this.y,this.x)},n.prototype.perpendicular=function(t){return this.subtract(this.project(t))},n.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},n.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},n.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},n.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},t.exports=n}),Matrix2D:h(function(t){function s(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,enumerable:!0,configurable:!1})}function i(t,e,n,r,i,o){s(this,"a",void 0!==t?t:1),s(this,"b",void 0!==e?e:0),s(this,"c",void 0!==n?n:0),s(this,"d",void 0!==r?r:1),s(this,"e",void 0!==i?i:0),s(this,"f",void 0!==o?o:0)}s(i,"IDENTITY",new i(1,0,0,1,0,0)),s(i.IDENTITY,"isIdentity",function(){return!0}),i.translation=function(t,e){return new i(1,0,0,1,t,e)},i.scaling=function(t){return new i(t,0,0,t,0,0)},i.scalingAt=function(t,e){return new i(t,0,0,t,e.x-e.x*t,e.y-e.y*t)},i.nonUniformScaling=function(t,e){return new i(t,0,0,e,0,0)},i.nonUniformScalingAt=function(t,e,n){return new i(t,0,0,e,n.x-n.x*t,n.y-n.y*e)},i.rotation=function(t){var e=Math.cos(t),n=Math.sin(t);return new i(e,n,-n,e,0,0)},i.rotationAt=function(t,e){var n=Math.cos(t),r=Math.sin(t);return new i(n,r,-r,n,e.x-e.x*n+e.y*r,e.y-e.y*n-e.x*r)},i.rotationFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new i(n,r,-r,n,0,0)},i.xFlip=function(){return new i(-1,0,0,1,0,0)},i.yFlip=function(){return new i(1,0,0,-1,0,0)},i.xSkew=function(t){return new i(1,0,Math.tan(t),1,0,0)},i.ySkew=function(t){return new i(1,Math.tan(t),0,1,0,0)},i.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},i.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw"Matrix is not invertible";var e=1/t,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,r*e)},i.prototype.translate=function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)},i.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},i.prototype.scaleAt=function(t,e){var n=e.x-t*e.x,r=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)},i.prototype.scaleNonUniform=function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)},i.prototype.scaleNonUniformAt=function(t,e,n){var r=n.x-t*n.x,i=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*r+this.c*i+this.e,this.b*r+this.d*i+this.f)},i.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)},i.prototype.rotateAt=function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x,o=e.y,s=this.a*n+this.c*r,a=this.b*n+this.d*r,u=this.c*n-this.a*r,h=this.d*n-this.b*r;return new this.constructor(s,a,u,h,(this.a-s)*i+(this.c-u)*o+this.e,(this.b-a)*i+(this.d-h)*o+this.f)},i.prototype.rotateFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)},i.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},i.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},i.prototype.skewX=function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*e,this.d+this.b*e,this.e,this.f)},i.prototype.skewY=function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)},i.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},i.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},i.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},i.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),i=Math.sqrt(t*t+r*r),o=Math.sqrt(e*e+n*n),s=i+o,a=i-o,u=Math.atan2(n,e),h=Math.atan2(r,t),c=.5*(h-u),l=.5*(h+u);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(l),scale:new this.constructor(s,0,0,a,0,0),rotation0:this.constructor.IDENTITY.rotate(c)}},i.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},i.prototype.precisionEquals=function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e},i.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},t.exports=i})},l=h(function(t){function x(){this.init(arguments)}x.TOLERANCE=1e-6,x.ACCURACY=15,x.interpolate=function(t,e,n,r,i){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(i))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var o=0,s=0,a=new Array(n),u=new Array(n),h=0,c=Math.abs(i-t[r]),l=0;l<n;l++){var p=Math.abs(i-t[r+l]);p<c&&(h=l,c=p),a[l]=u[l]=e[r+l]}o=e[r+h],h--;for(var y=1;y<n;y++){for(l=0;l<n-y;l++){var f=t[r+l]-i,x=t[r+l+y]-i,v=a[l+1]-u[l],d=f-x;if(0==d)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");d=v/d,u[l]=x*d,a[l]=f*d}o+=s=2*(h+1)<n-y?a[h+1]:u[h--]}return{y:o,dy:s}},x.prototype.init=function(t){this.coefs=new Array;for(var e=t.length-1;0<=e;e--)this.coefs.push(t[e]);this._variable="t",this._s=0},x.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var e=0,n=this.coefs.length-1;0<=n;n--)e=e*t+this.coefs[n];return e},x.prototype.add=function(t){for(var e=new x,n=this.getDegree(),r=t.getDegree(),i=Math.max(n,r),o=0;o<=i;o++){var s=o<=n?this.coefs[o]:0,a=o<=r?t.coefs[o]:0;e.coefs[o]=s+a}return e},x.prototype.multiply=function(t){for(var e=new x,n=0;n<=this.getDegree()+t.getDegree();n++)e.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=t.getDegree();r++)e.coefs[n+r]+=this.coefs[n]*t.coefs[r];return e},x.prototype.divide_scalar=function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t},x.prototype.simplify=function(t){void 0===t&&(t=1e-12);for(var e=this.getDegree();0<=e&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()},x.prototype.bisection=function(t,e){var n,r=this.eval(t),i=this.eval(e);if(Math.abs(r)<=x.TOLERANCE)n=t;else if(Math.abs(i)<=x.TOLERANCE)n=e;else if(r*i<=0)for(var o=Math.log(e-t),s=Math.LN10*x.ACCURACY,a=Math.ceil((o+s)/Math.LN2),u=0;u<a;u++){n=.5*(t+e);var h=this.eval(n);if(Math.abs(h)<=x.TOLERANCE)break;h*r<0?(e=n,i=h):(t=n,r=h)}return n},x.prototype.toString=function(){for(var t=new Array,e=new Array,n=this.coefs.length-1;0<=n;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!=r){var i=r<0?" - ":" + ";r=Math.abs(r),0<n&&(1==r?r=this._variable:r+=this._variable),1<n&&(r+="^"+n),e.push(i),t.push(r)}}e[0]=" + "==e[0]?"":"-";var o="";for(n=0;n<t.length;n++)o+=e[n]+t[n];return o},x.prototype.trapezoid=function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var r=e-t;if(1==n){var i=this.eval(t),o=this.eval(e);this._s=.5*r*(i+o)}else{for(var s=1<<n-2,a=r/s,u=t+.5*a,h=0,c=0;c<s;c++)h+=this.eval(u),u+=a;this._s=.5*(this._s+r*h/s)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},x.prototype.simpson=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,r=.5*n*(this.eval(t)+this.eval(e)),i=r,o=4*r/3,s=o,a=r,u=1,h=2;h<=20;h++){for(var c=n/u,l=t+.5*c,p=0,y=1;y<=u;y++)p+=this.eval(l),l+=c;if(o=(4*(r=i=.5*(i+n*p/u))-a)/3,Math.abs(o-s)<1e-7*Math.abs(s))break;s=o,a=r,u<<=1}return o},x.prototype.romberg=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.romberg: parameters must be numbers");for(var n=new Array(21),r=new Array(21),i={y:0,dy:0},o=r[0]=1;o<=20&&(n[o-1]=this.trapezoid(t,e,o),!(3<=o&&(i=x.interpolate(r,n,3,o-3,0),Math.abs(i.dy)<=1e-6*i.y)));o++)n[o]=n[o-1],r[o]=.25*r[o-1];return i.y},x.prototype.getDegree=function(){return this.coefs.length-1},x.prototype.getDerivative=function(){for(var t=new x,e=1;e<this.coefs.length;e++)t.coefs.push(e*this.coefs[e]);return t},x.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t},x.prototype.getRootsInInterval=function(t,e){var n,r=new Array;if(1==this.getDegree())null!=(n=this.bisection(t,e))&&r.push(n);else{var o=this.getDerivative().getRootsInInterval(t,e);if(0<o.length){for(null!=(n=this.bisection(t,o[0]))&&r.push(n),i=0;i<=o.length-2;i++)null!=(n=this.bisection(o[i],o[i+1]))&&r.push(n);null!=(n=this.bisection(o[o.length-1],e))&&r.push(n)}else null!=(n=this.bisection(t,e))&&r.push(n)}return r},x.prototype.getLinearRoot=function(){var t=[],e=this.coefs[1];return 0!=e&&t.push(-this.coefs[0]/e),t},x.prototype.getQuadraticRoots=function(){var t=[];if(2==this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,r=n*n-4*(this.coefs[0]/e);if(0<r){var i=Math.sqrt(r);t.push(.5*(-n+i)),t.push(.5*(-n-i))}else 0==r&&t.push(.5*-n)}return t},x.prototype.getCubicRoots=function(){var t=[];if(3==this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,r=this.coefs[1]/e,i=(3*r-n*n)/3,o=(2*n*n*n-9*r*n+27*(this.coefs[0]/e))/27,s=n/3,a=o*o/4+i*i*i/27,u=o/2,h=this.zeroErrorEstimate();if(Math.abs(a)<=h&&(a=0),0<a){var c,l=Math.sqrt(a);c=0<=(d=-u+l)?Math.pow(d,1/3):-Math.pow(-d,1/3),0<=(d=-u-l)?c+=Math.pow(d,1/3):c-=Math.pow(-d,1/3),t.push(c-s)}else if(a<0){var p=Math.sqrt(-i/3),y=Math.atan2(Math.sqrt(-a),-u)/3,f=Math.cos(y),x=Math.sin(y),v=Math.sqrt(3);t.push(2*p*f-s),t.push(-p*(f+v*x)-s),t.push(-p*(f-v*x)-s)}else{var d;d=0<=u?-Math.pow(u,1/3):Math.pow(-u,1/3),t.push(2*d-s),t.push(-d-s)}}return t};var w=function(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN};x.prototype.getQuarticRoots=function(){var t=[],e=this.getDegree();if(4==e){var n=new x;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[e]);Math.abs(n.coefs[0])<10*1e-15*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var r,i=n.getDerivative(),o=i.getRoots().sort(function(t,e){return t-e}),s=[],a=o.length-1,u=this.bounds();maxabsX=Math.max(Math.abs(u.minX),Math.abs(u.maxX));var h=this.zeroErrorEstimate(maxabsX);for(r=0;r<=a;r++)s.push(n.eval(o[r]));for(r=0;r<=a;r++)Math.abs(s[r])<h&&(s[r]=0);r=0;var c=Math.max(.1*(u.maxX-u.minX)/e,1e-15),l=[],p=[];if(-1<a){for(0!=s[0]?w(s[0])!=w(n.eval(o[0]-c)-s[0])&&(l.push(o[0]-c),p.push([u.minX,o[0]])):(t.push(o[0],o[0]),r++);r<a;r++)0==s[r+1]?(t.push(o[r+1],o[r+1]),r++):w(s[r])!=w(s[r+1])&&(l.push((o[r]+o[r+1])/2),p.push([o[r],o[r+1]]));0!=s[a]&&w(s[a])!=w(n.eval(o[a]+c)-s[a])&&(l.push(o[a]+c),p.push([o[a],u.maxX]))}var y=function(t){return n.eval(t)},f=function(t){return i.eval(t)};if(0<l.length)for(r=0;r<l.length;r++)l[r]=x.newton_secant_bisection(l[r],y,f,32,p[r][0],p[r][1]);t=t.concat(l)}return t},x.prototype.zeroErrorEstimate=function(i){var t=this;if(void 0===i){var e=t.bounds();i=Math.max(Math.abs(e.minX),Math.abs(e.maxX))}if(i<.001)return 2*Math.abs(t.eval(1e-15));var n=t.coefs.length-1,o=t.coefs[n];return 10*1e-15*t.coefs.reduce(function(t,e,n){var r=e/o*Math.pow(i,n);return t<r?r:t},0)},x.prototype.bounds_UpperReal_Fujiwara=function(){var e=this.coefs,n=e.length-1,r=e[n];1!=r&&(e=this.coefs.map(function(t){return t/r}));var i,t=e.map(function(t,e){return e<n?Math.pow(Math.abs(0==e?t/2:t),1/(n-e)):t}),o=function(t,e,n){return i(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};i=function(t){return t<n&&e[t]<0};var s=t.reduce(o,{max:0,nearmax:0});return i=function(t){return t<n&&(n%2==t%2?e[t]<0:0<e[t])},{negX:-2*t.reduce(o,{max:0,nearmax:0}).max,posX:2*s.max}},x.prototype.bounds_LowerReal_Fujiwara=function(){var t=new x;t.coefs=this.coefs.slice().reverse();var e=t.bounds_UpperReal_Fujiwara();return e.negX=1/e.negX,e.posX=1/e.posX,e},x.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX||(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0)),e},x.newton_secant_bisection=function(t,e,n,r,i,o){var s,a,u,h,c,l,p=0,f=0;s=t;var x=Math.pow(10,-14),v="number"==typeof i&&"number"==typeof o;if(v){if(o<i)throw new Error("newton root finding: min must be greater than max");if(c=e(i),l=e(o),w(c)==w(l))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var d,g=function(){return Math.abs(u)<=x*Math.abs(s)||f==s-u-s};for(d=0;d<r;d++){if(0==(a=n(s))){if(0==p)throw new Error("newton root finding: df(x) is zero");a=p}if(p=a,y=e(s),u=y/a,h=s-u,g())break;if(v){if(w(y)==w(l))o=s,l=y;else{if(w(y)!=w(c)){s=h;break}i=s,c=y}if(h<i||o<h){if(w(c)==w(l))break;var m=l-c,b=o-i;if(u=0==m?s-(i+.5*b):50<Math.abs(m/Math.min(c,l))?s-(i+b*(.5+(Math.abs(c)<Math.abs(l)?-.25:.25))):s-(i-c/m*b),h=s-u,g())break}}f=s-h,s=h}return s},t.exports=x}),p=h(function(t){var e=l;function n(){this.init(arguments)}n.VERSION=1,((n.prototype=new e).constructor=n).superclass=e.prototype,n.prototype.eval=function(t){var e=n.superclass.eval.call(this,t);if(Math.abs(e)<1e-7&&(e=0),e<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(e)},n.prototype.toString=function(){return"sqrt("+n.superclass.toString.call(this)+")"},t.exports=n}),f={Polynomial:l,SqrtPolynomial:p},x=(h(function(t){var X=c.Point2D,tt=c.Vector2D,et=f.Polynomial;function o(t){var e=t.slice();return e.push(t[0]),e}function nt(t){this.init(t)}nt.prototype.init=function(t){this.status=t,this.points=new Array},nt.prototype.appendPoint=function(t){this.points.push(t)},nt.prototype.appendPoints=function(t){this.points=this.points.concat(t)},nt.intersect=function(t,e){var n;if(null!=t&&null!=e)if("Path"==t.name)n=nt.intersectPathShape(t,e);else if("Path"==e.name)n=nt.intersectPathShape(e,t);else{var r,i;if(t.name<e.name?(r="intersect"+t.name+e.name,i=t.args.concat(e.args)):(r="intersect"+e.name+t.name,i=e.args.concat(t.args)),!(r in nt))throw new Error("Intersection not available: "+r);n=nt[r].apply(null,i)}else n=new nt("No Intersection");return n},nt.intersectPathShape=function(t,e){for(var n=new nt("No Intersection"),r=t.args.length,i=0;i<r;i++){var o=t.args[i],s=nt.intersect(o,e);n.appendPoints(s.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectBezier2Bezier2=function(t,e,n,r,i,o){var s,a,u,h,c,l,p=new nt("No Intersection");y=e.multiply(-2),s=t.add(y.add(n)),y=t.multiply(-2),f=e.multiply(2),a=y.add(f),u=new X(t.x,t.y),y=i.multiply(-2),h=r.add(y.add(o)),y=r.multiply(-2),f=i.multiply(2),c=y.add(f),l=new X(r.x,r.y);for(var y=s.x*a.y-a.x*s.y,f=h.x*a.y-a.x*h.y,x=c.x*a.y-a.x*c.y,v=a.x*(u.y-l.y)+a.y*(-u.x+l.x),d=h.x*s.y-s.x*h.y,g=c.x*s.y-s.x*c.y,m=s.x*(u.y-l.y)+s.y*(-u.x+l.x),b=new et(-d*d,-2*d*g,y*f-g*g-2*d*m,y*x-2*g*m,y*v-m*m).getRoots(),w=0;w<b.length;w++){var _=b[w];if(0<=_&&_<=1){var P=new et(s.x,a.x,u.x-l.x-_*c.x-_*_*h.x);P.simplify();var M=P.getRoots(),I=new et(s.y,a.y,u.y-l.y-_*c.y-_*_*h.y);I.simplify();var j=I.getRoots();if(0<M.length&&0<j.length){t:for(var E=0;E<M.length;E++){var R=M[E];if(0<=R&&R<=1)for(var k=0;k<j.length;k++)if(Math.abs(R-j[k])<1e-4){p.points.push(h.multiply(_*_).add(c.multiply(_).add(l)));break t}}}}}return 0<p.points.length&&(p.status="Intersection"),p},nt.intersectBezier2Bezier3=function(t,e,n,r,i,o,s){var a,u,h,c,l,p,y,f,x,v,d,g=new nt("No Intersection");a=e.multiply(-2),l=t.add(a.add(n)),a=t.multiply(-2),u=e.multiply(2),p=a.add(u),y=new X(t.x,t.y),a=r.multiply(-1),u=i.multiply(3),h=o.multiply(-3),c=a.add(u.add(h.add(s))),f=new tt(c.x,c.y),a=r.multiply(3),u=i.multiply(-6),h=o.multiply(3),c=a.add(u.add(h)),x=new tt(c.x,c.y),a=r.multiply(-3),u=i.multiply(3),h=a.add(u),v=new tt(h.x,h.y),d=new tt(r.x,r.y);for(var m=y.x*y.x,b=y.y*y.y,w=p.x*p.x,_=p.y*p.y,P=l.x*l.x,M=l.y*l.y,I=d.x*d.x,j=d.y*d.y,E=v.x*v.x,R=v.y*v.y,k=x.x*x.x,S=x.y*x.y,L=f.x*f.x,O=f.y*f.y,N=new et(-2*l.x*l.y*f.x*f.y+P*O+M*L,-2*l.x*l.y*x.x*f.y-2*l.x*l.y*x.y*f.x+2*M*x.x*f.x+2*P*x.y*f.y,-2*l.x*v.x*l.y*f.y-2*l.x*l.y*v.y*f.x-2*l.x*l.y*x.x*x.y+2*v.x*M*f.x+M*k+P*(2*v.y*f.y+S),2*y.x*l.x*l.y*f.y+2*y.y*l.x*l.y*f.x+p.x*p.y*l.x*f.y+p.x*p.y*l.y*f.x-2*d.x*l.x*l.y*f.y-2*l.x*d.y*l.y*f.x-2*l.x*v.x*l.y*x.y-2*l.x*l.y*v.y*x.x-2*y.x*M*f.x-2*y.y*P*f.y+2*d.x*M*f.x+2*v.x*M*x.x-_*l.x*f.x-w*l.y*f.y+P*(2*d.y*f.y+2*v.y*x.y),2*y.x*l.x*l.y*x.y+2*y.y*l.x*l.y*x.x+p.x*p.y*l.x*x.y+p.x*p.y*l.y*x.x-2*d.x*l.x*l.y*x.y-2*l.x*d.y*l.y*x.x-2*l.x*v.x*l.y*v.y-2*y.x*M*x.x-2*y.y*P*x.y+2*d.x*M*x.x-_*l.x*x.x-w*l.y*x.y+E*M+P*(2*d.y*x.y+R),2*y.x*l.x*l.y*v.y+2*y.y*l.x*v.x*l.y+p.x*p.y*l.x*v.y+p.x*p.y*v.x*l.y-2*d.x*l.x*l.y*v.y-2*l.x*d.y*v.x*l.y-2*y.x*v.x*M-2*y.y*P*v.y+2*d.x*v.x*M-_*l.x*v.x-w*l.y*v.y+2*P*d.y*v.y,-2*y.x*y.y*l.x*l.y-y.x*p.x*p.y*l.y-y.y*p.x*p.y*l.x+2*y.x*l.x*d.y*l.y+2*y.y*d.x*l.x*l.y+p.x*d.x*p.y*l.y+p.x*p.y*l.x*d.y-2*d.x*l.x*d.y*l.y-2*y.x*d.x*M+y.x*_*l.x+y.y*w*l.y-2*y.y*P*d.y-d.x*_*l.x-w*d.y*l.y+m*M+b*P+I*M+P*j).getRootsInInterval(0,1),z=0;z<N.length;z++){var T=N[z],A=new et(l.x,p.x,y.x-d.x-T*v.x-T*T*x.x-T*T*T*f.x).getRoots(),C=new et(l.y,p.y,y.y-d.y-T*v.y-T*T*x.y-T*T*T*f.y).getRoots();if(0<A.length&&0<C.length){t:for(var B=0;B<A.length;B++){var D=A[B];if(0<=D&&D<=1)for(var G=0;G<C.length;G++)if(Math.abs(D-C[G])<1e-4){g.points.push(f.multiply(T*T*T).add(x.multiply(T*T).add(v.multiply(T).add(d))));break t}}}}return 0<g.points.length&&(g.status="Intersection"),g},nt.intersectBezier2Circle=function(t,e,n,r,i){return nt.intersectBezier2Ellipse(t,e,n,r,i,i)},nt.intersectBezier2Ellipse=function(t,e,n,r,i,o){var s,a,u,h,c,l=new nt("No Intersection");s=e.multiply(-2),u=t.add(s.add(n)),s=t.multiply(-2),a=e.multiply(2),h=s.add(a),c=new X(t.x,t.y);for(var p=i*i,y=o*o,f=new et(y*u.x*u.x+p*u.y*u.y,2*(y*u.x*h.x+p*u.y*h.y),y*(2*u.x*c.x+h.x*h.x)+p*(2*u.y*c.y+h.y*h.y)-2*(y*r.x*u.x+p*r.y*u.y),2*(y*h.x*(c.x-r.x)+p*h.y*(c.y-r.y)),y*(c.x*c.x+r.x*r.x)+p*(c.y*c.y+r.y*r.y)-2*(y*r.x*c.x+p*r.y*c.y)-p*y).getRoots(),x=0;x<f.length;x++){var v=f[x];0<=v&&v<=1&&l.points.push(u.multiply(v*v).add(h.multiply(v).add(c)))}return 0<l.points.length&&(l.status="Intersection"),l},nt.intersectBezier2Line=function(t,e,n,r,i){var o,s,a,u,h,c,l,p=r.min(i),y=r.max(i),f=new nt("No Intersection");o=e.multiply(-2),a=t.add(o.add(n)),o=t.multiply(-2),s=e.multiply(2),u=o.add(s),h=new X(t.x,t.y),l=new tt(r.y-i.y,i.x-r.x),c=r.x*i.y-i.x*r.y,roots=new et(l.dot(a),l.dot(u),l.dot(h)+c).getRoots();for(var x=0;x<roots.length;x++){var v=roots[x];if(0<=v&&v<=1){var d=t.lerp(e,v),g=e.lerp(n,v),m=d.lerp(g,v);r.x==i.x?p.y<=m.y&&m.y<=y.y&&(f.status="Intersection",f.appendPoint(m)):r.y==i.y?p.x<=m.x&&m.x<=y.x&&(f.status="Intersection",f.appendPoint(m)):p.x<=m.x&&m.x<=y.x&&p.y<=m.y&&m.y<=y.y&&(f.status="Intersection",f.appendPoint(m))}}return f},nt.intersectBezier2Polygon=function(t,e,n,r){return nt.intersectBezier2Polyline(t,e,n,o(r))},nt.intersectBezier2Polyline=function(t,e,n,r){for(var i=new nt("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],h=nt.intersectBezier2Line(t,e,n,a,u);i.appendPoints(h.points)}return 0<i.points.length&&(i.status="Intersection"),i},nt.intersectBezier2Rectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new X(s.x,o.y),u=new X(o.x,s.y),h=nt.intersectBezier2Line(t,e,n,o,a),c=nt.intersectBezier2Line(t,e,n,a,s),l=nt.intersectBezier2Line(t,e,n,s,u),p=nt.intersectBezier2Line(t,e,n,u,o),y=new nt("No Intersection");return y.appendPoints(h.points),y.appendPoints(c.points),y.appendPoints(l.points),y.appendPoints(p.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectBezier3Bezier3=function(t,e,n,r,i,o,s,a){var u,h,c,l,p,y,f,x,v,d=new nt("No Intersection");g=t.multiply(-1),m=e.multiply(3),u=n.multiply(-3),M=g.add(m.add(u.add(r))),h=new tt(M.x,M.y),g=t.multiply(3),m=e.multiply(-6),u=n.multiply(3),M=g.add(m.add(u)),c=new tt(M.x,M.y),g=t.multiply(-3),m=e.multiply(3),u=g.add(m),l=new tt(u.x,u.y),p=new tt(t.x,t.y),g=i.multiply(-1),m=o.multiply(3),u=s.multiply(-3),M=g.add(m.add(u.add(a))),y=new tt(M.x,M.y),g=i.multiply(3),m=o.multiply(-6),u=s.multiply(3),M=g.add(m.add(u)),f=new tt(M.x,M.y),g=i.multiply(-3),m=o.multiply(3),u=g.add(m),x=new tt(u.x,u.y),v=new tt(i.x,i.y);var g=h.x*c.y-c.x*h.y,m=h.x*l.y-l.x*h.y,b=h.x*p.y-p.x*h.y+v.x*h.y-h.x*v.y,w=x.x*h.y-h.x*x.y,_=f.x*h.y-h.x*f.y,P=y.x*h.y-h.x*y.y,M=h.x*l.y-l.x*h.y,I=h.x*p.y+c.x*l.y-l.x*c.y-p.x*h.y+v.x*h.y-h.x*v.y,j=x.x*h.y-h.x*x.y,E=f.x*h.y-h.x*f.y,R=y.x*h.y-h.x*y.y,k=c.x*p.y-p.x*c.y+v.x*c.y-c.x*v.y,S=x.x*c.y-c.x*x.y,L=f.x*c.y-c.x*f.y,O=y.x*c.y-c.x*y.y,N=h.x*p.y-p.x*h.y+v.x*h.y-h.x*v.y,z=x.x*h.y-h.x*x.y,T=f.x*h.y-h.x*f.y,A=y.x*h.y-h.x*y.y,C=c.x*p.y-p.x*c.y+v.x*c.y-c.x*v.y,B=x.x*c.y-c.x*x.y,D=f.x*c.y-c.x*f.y,G=y.x*c.y-c.x*y.y,X=l.x*p.y-p.x*l.y+v.x*l.y-l.x*v.y,q=x.x*l.y-l.x*x.y,F=f.x*l.y-l.x*f.y,W=y.x*l.y-l.x*y.y,U=new et(-P*R*A,-P*R*T-P*E*A-_*R*A,-P*R*z-P*E*T-_*R*T-P*j*A-_*E*A-w*R*A,-P*R*N-P*E*z-_*R*z-P*j*T-_*E*T-w*R*T-P*I*A-_*j*A-w*E*A-b*R*A+m*O*A+P*M*G-g*O*G+g*R*W,-P*E*N-_*R*N-P*j*z-_*E*z-w*R*z-P*I*T-_*j*T-w*E*T-b*R*T+m*O*T-_*I*A-w*j*A-b*E*A+m*L*A+P*M*D-g*O*D+_*M*G-g*L*G+g*R*F+g*E*W,-P*j*N-_*E*N-w*R*N-P*I*z-_*j*z-w*E*z-b*R*z+m*O*z-_*I*T-w*j*T-b*E*T+m*L*T-w*I*A-b*j*A+m*S*A+P*M*B-g*O*B+_*M*D-g*L*D+w*M*G-g*S*G+g*R*q+g*E*F+g*j*W,-P*I*N-_*j*N-w*E*N-b*R*N+m*O*N-_*I*z-w*j*z-b*E*z+m*L*z-w*I*T-b*j*T+m*S*T-b*I*A+m*k*A+P*M*C-g*O*C+_*M*B-g*L*B+w*M*D-g*S*D+b*M*G-g*k*G+g*R*X+g*E*q+g*j*F-m*M*W+g*I*W,-_*I*N-w*j*N-b*E*N+m*L*N-w*I*z-b*j*z+m*S*z-b*I*T+m*k*T+_*M*C-g*L*C+w*M*B-g*S*B+b*M*D-g*k*D+g*E*X+g*j*q-m*M*F+g*I*F,-w*I*N-b*j*N+m*S*N-b*I*z+m*k*z+w*M*C-g*S*C+b*M*B-g*k*B+g*j*X-m*M*q+g*I*q,-b*I*N+m*k*N+b*M*C-g*k*C-m*M*X+g*I*X);U.simplify();for(var V=U.getRootsInInterval(0,1),Y=0;Y<V.length;Y++){var $=V[Y],H=new et(h.x,c.x,l.x,p.x-v.x-$*x.x-$*$*f.x-$*$*$*y.x);H.simplify(),xRoots=H.getRoots();var Q=new et(h.y,c.y,l.y,p.y-v.y-$*x.y-$*$*f.y-$*$*$*y.y);if(Q.simplify(),yRoots=Q.getRoots(),0<xRoots.length&&0<yRoots.length){t:for(var J=0;J<xRoots.length;J++){var K=xRoots[J];if(0<=K&&K<=1)for(var Z=0;Z<yRoots.length;Z++)if(Math.abs(K-yRoots[Z])<1e-4){d.points.push(y.multiply($*$*$).add(f.multiply($*$).add(x.multiply($).add(v))));break t}}}}return 0<d.points.length&&(d.status="Intersection"),d},nt.intersectBezier3Circle=function(t,e,n,r,i,o){return nt.intersectBezier3Ellipse(t,e,n,r,i,o,o)},nt.intersectBezier3Ellipse=function(t,e,n,r,i,o,s){var a,u,h,c,l,p,y,f,x=new nt("No Intersection");a=t.multiply(-1),u=e.multiply(3),h=n.multiply(-3),c=a.add(u.add(h.add(r))),l=new tt(c.x,c.y),a=t.multiply(3),u=e.multiply(-6),h=n.multiply(3),c=a.add(u.add(h)),p=new tt(c.x,c.y),a=t.multiply(-3),u=e.multiply(3),h=a.add(u),y=new tt(h.x,h.y),f=new tt(t.x,t.y);for(var v=o*o,d=s*s,g=new et(l.x*l.x*d+l.y*l.y*v,2*(l.x*p.x*d+l.y*p.y*v),2*(l.x*y.x*d+l.y*y.y*v)+p.x*p.x*d+p.y*p.y*v,2*l.x*d*(f.x-i.x)+2*l.y*v*(f.y-i.y)+2*(p.x*y.x*d+p.y*y.y*v),2*p.x*d*(f.x-i.x)+2*p.y*v*(f.y-i.y)+y.x*y.x*d+y.y*y.y*v,2*y.x*d*(f.x-i.x)+2*y.y*v*(f.y-i.y),f.x*f.x*d-2*f.y*i.y*v-2*f.x*i.x*d+f.y*f.y*v+i.x*i.x*d+i.y*i.y*v-v*d).getRootsInInterval(0,1),m=0;m<g.length;m++){var b=g[m];x.points.push(l.multiply(b*b*b).add(p.multiply(b*b).add(y.multiply(b).add(f))))}return 0<x.points.length&&(x.status="Intersection"),x},nt.intersectBezier3Line=function(t,e,n,r,i,o){var s,a,u,h,c,l,p,y,f,x,v=i.min(o),d=i.max(o),g=new nt("No Intersection");s=t.multiply(-1),a=e.multiply(3),u=n.multiply(-3),h=s.add(a.add(u.add(r))),c=new tt(h.x,h.y),s=t.multiply(3),a=e.multiply(-6),u=n.multiply(3),h=s.add(a.add(u)),l=new tt(h.x,h.y),s=t.multiply(-3),a=e.multiply(3),u=s.add(a),p=new tt(u.x,u.y),y=new tt(t.x,t.y),x=new tt(i.y-o.y,o.x-i.x),f=i.x*o.y-o.x*i.y,roots=new et(x.dot(c),x.dot(l),x.dot(p),x.dot(y)+f).getRoots();for(var m=0;m<roots.length;m++){var b=roots[m];if(0<=b&&b<=1){var w=t.lerp(e,b),_=e.lerp(n,b),P=n.lerp(r,b),M=w.lerp(_,b),I=_.lerp(P,b),j=M.lerp(I,b);i.x==o.x?v.y<=j.y&&j.y<=d.y&&(g.status="Intersection",g.appendPoint(j)):i.y==o.y?v.x<=j.x&&j.x<=d.x&&(g.status="Intersection",g.appendPoint(j)):v.x<=j.x&&j.x<=d.x&&v.y<=j.y&&j.y<=d.y&&(g.status="Intersection",g.appendPoint(j))}}return g},nt.intersectBezier3Polygon=function(t,e,n,r,i){return this.intersectBezier3Polyline(t,e,n,r,o(i))},nt.intersectBezier3Polyline=function(t,e,n,r,i){for(var o=new nt("No Intersection"),s=i.length,a=0;a<s-1;a++){var u=i[a],h=i[a+1],c=nt.intersectBezier3Line(t,e,n,r,u,h);o.appendPoints(c.points)}return 0<o.points.length&&(o.status="Intersection"),o},nt.intersectBezier3Rectangle=function(t,e,n,r,i,o){var s=i.min(o),a=i.max(o),u=new X(a.x,s.y),h=new X(s.x,a.y),c=nt.intersectBezier3Line(t,e,n,r,s,u),l=nt.intersectBezier3Line(t,e,n,r,u,a),p=nt.intersectBezier3Line(t,e,n,r,a,h),y=nt.intersectBezier3Line(t,e,n,r,h,s),f=new nt("No Intersection");return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(p.points),f.appendPoints(y.points),0<f.points.length&&(f.status="Intersection"),f},nt.intersectCircleCircle=function(t,e,n,r){var i,o=e+r,s=Math.abs(e-r),a=t.distanceFrom(n);if(o<a)i=new nt("Outside");else if(a<s)i=new nt("Inside");else{i=new nt("Intersection");var u=(e*e-r*r+a*a)/(2*a),h=Math.sqrt(e*e-u*u),c=t.lerp(n,u/a),l=h/a;i.points.push(new X(c.x-l*(n.y-t.y),c.y+l*(n.x-t.x))),i.points.push(new X(c.x+l*(n.y-t.y),c.y-l*(n.x-t.x)))}return i},nt.intersectCircleEllipse=function(t,e,n,r,i){return nt.intersectEllipseEllipse(t,e,e,n,r,i)},nt.intersectCircleLine=function(t,e,n,r){var i,o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),s=2*((r.x-n.x)*(n.x-t.x)+(r.y-n.y)*(n.y-t.y)),a=s*s-4*o*(t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-e*e);if(a<0)i=new nt("Outside");else if(0==a)i=new nt("Tangent");else{var u=Math.sqrt(a),h=(-s+u)/(2*o),c=(-s-u)/(2*o);(h<0||1<h)&&(c<0||1<c)?i=new nt(h<0&&c<0||1<h&&1<c?"Outside":"Inside"):(i=new nt("Intersection"),0<=h&&h<=1&&i.points.push(n.lerp(r,h)),0<=c&&c<=1&&i.points.push(n.lerp(r,c)))}return i},nt.intersectCirclePolygon=function(t,e,n){return this.intersectCirclePolyline(t,e,o(n))},nt.intersectCirclePolyline=function(t,e,n){for(var r,i=new nt("No Intersection"),o=n.length,s=0;s<o-1;s++){var a=n[s],u=n[s+1];r=nt.intersectCircleLine(t,e,a,u),i.appendPoints(r.points)}return 0<i.points.length?i.status="Intersection":i.status=r.status,i},nt.intersectCircleRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectCircleLine(t,e,i,s),h=nt.intersectCircleLine(t,e,s,o),c=nt.intersectCircleLine(t,e,o,a),l=nt.intersectCircleLine(t,e,a,i),p=new nt("No Intersection");return p.appendPoints(u.points),p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(l.points),0<p.points.length?p.status="Intersection":p.status=u.status,p},nt.intersectEllipseEllipse=function(t,e,n,r,i,o){for(var s=[n*n,0,e*e,-2*n*n*t.x,-2*e*e*t.y,n*n*t.x*t.x+e*e*t.y*t.y-e*e*n*n],a=[o*o,0,i*i,-2*o*o*r.x,-2*i*i*r.y,o*o*r.x*r.x+i*i*r.y*r.y-i*i*o*o],u=nt.bezout(s,a).getRoots(),h=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),c=.001*(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2]),l=new nt("No Intersection"),p=0;p<u.length;p++)for(var y=new et(s[0],s[3]+u[p]*s[1],s[5]+u[p]*(s[4]+u[p]*s[2])).getRoots(),f=0;f<y.length;f++){var x=(s[0]*y[f]+s[1]*u[p]+s[3])*y[f]+(s[2]*u[p]+s[4])*u[p]+s[5];Math.abs(x)<h&&(x=(a[0]*y[f]+a[1]*u[p]+a[3])*y[f]+(a[2]*u[p]+a[4])*u[p]+a[5],Math.abs(x)<c&&l.appendPoint(new X(y[f],u[p])))}return 0<l.points.length&&(l.status="Intersection"),l},nt.intersectEllipseLine=function(t,e,n,r,i){var o,s=new tt(r.x,r.y),a=tt.fromPoints(r,i),u=new tt(t.x,t.y),h=s.subtract(u),c=new tt(a.x/(e*e),a.y/(n*n)),l=new tt(h.x/(e*e),h.y/(n*n)),p=a.dot(c),y=a.dot(l),f=y*y-p*(t=h.dot(l)-1);if(f<0)o=new nt("Outside");else if(0<f){var x=Math.sqrt(f),v=(-y-x)/p,d=(-y+x)/p;(v<0||1<v)&&(d<0||1<d)?o=new nt(v<0&&d<0||1<v&&1<d?"Outside":"Inside"):(o=new nt("Intersection"),0<=v&&v<=1&&o.appendPoint(r.lerp(i,v)),0<=d&&d<=1&&o.appendPoint(r.lerp(i,d)))}else{var g=-y/p;0<=g&&g<=1?(o=new nt("Intersection")).appendPoint(r.lerp(i,g)):o=new nt("Outside")}return o},nt.intersectEllipsePolygon=function(t,e,n,r){return this.intersectEllipsePolyline(t,e,n,o(r))},nt.intersectEllipsePolyline=function(t,e,n,r){for(var i=new nt("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],h=nt.intersectEllipseLine(t,e,n,a,u);i.appendPoints(h.points)}return 0<i.points.length&&(i.status="Intersection"),i},nt.intersectEllipseRectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new X(s.x,o.y),u=new X(o.x,s.y),h=nt.intersectEllipseLine(t,e,n,o,a),c=nt.intersectEllipseLine(t,e,n,a,s),l=nt.intersectEllipseLine(t,e,n,s,u),p=nt.intersectEllipseLine(t,e,n,u,o),y=new nt("No Intersection");return y.appendPoints(h.points),y.appendPoints(c.points),y.appendPoints(l.points),y.appendPoints(p.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectLineLine=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=o/a,h=s/a;0<=u&&u<=1&&0<=h&&h<=1?(i=new nt("Intersection")).points.push(new X(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y))):i=new nt("No Intersection")}else i=new nt(0==o||0==s?"Coincident":"Parallel");return i},nt.intersectLinePolygon=function(t,e,n){return this.intersectLinePolyline(t,e,o(n))},nt.intersectLinePolyline=function(t,e,n){for(var r=new nt("No Intersection"),i=n.length,o=0;o<i-1;o++){var s=n[o],a=n[o+1],u=nt.intersectLineLine(t,e,s,a);r.appendPoints(u.points)}return 0<r.points.length&&(r.status="Intersection"),r},nt.intersectLineRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectLineLine(i,s,t,e),h=nt.intersectLineLine(s,o,t,e),c=nt.intersectLineLine(o,a,t,e),l=nt.intersectLineLine(a,i,t,e),p=new nt("No Intersection");return p.appendPoints(u.points),p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(l.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectPolygonPolygon=function(t,e){return this.intersectPolylinePolyline(o(t),o(e))},nt.intersectPolygonPolyline=function(t,e){return this.intersectPolylinePolyline(o(t),e)},nt.intersectPolygonRectangle=function(t,e,n){return this.intersectPolylineRectangle(o(t),e,n)},nt.intersectPolylinePolyline=function(t,e){for(var n=new nt("No Intersection"),r=t.length,i=0;i<r-1;i++){var o=t[i],s=t[i+1],a=nt.intersectLinePolyline(o,s,e);n.appendPoints(a.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectPolylineRectangle=function(t,e,n){var r=e.min(n),i=e.max(n),o=new X(i.x,r.y),s=new X(r.x,i.y),a=nt.intersectLinePolyline(r,o,t),u=nt.intersectLinePolyline(o,i,t),h=nt.intersectLinePolyline(i,s,t),c=nt.intersectLinePolyline(s,r,t),l=new nt("No Intersection");return l.appendPoints(a.points),l.appendPoints(u.points),l.appendPoints(h.points),l.appendPoints(c.points),0<l.points.length&&(l.status="Intersection"),l},nt.intersectRectangleRectangle=function(t,e,n,r){var i=t.min(e),o=t.max(e),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectLineRectangle(i,s,n,r),h=nt.intersectLineRectangle(s,o,n,r),c=nt.intersectLineRectangle(o,a,n,r),l=nt.intersectLineRectangle(a,i,n,r),p=new nt("No Intersection");return p.appendPoints(u.points),p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(l.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectRayRay=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=o/a;(i=new nt("Intersection")).points.push(new X(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y)))}else i=new nt(0==o||0==s?"Coincident":"Parallel");return i},nt.bezout=function(t,e){var n=t[0]*e[1]-e[0]*t[1],r=t[0]*e[2]-e[0]*t[2],i=t[0]*e[3]-e[0]*t[3],o=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],a=t[1]*e[2]-e[1]*t[2],u=t[1]*e[4]-e[1]*t[4],h=t[1]*e[5]-e[1]*t[5],c=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],p=t[3]*e[5]-e[3]*t[5],y=h+l,f=u-c;return new et(n*a-r*r,n*f+i*a-2*r*o,n*y+i*f-o*o-2*r*s,n*p+i*y-2*o*s,i*p-s*s)},t.exports=nt}),h(function(t){function e(t,e){this.init(t,e)}e.prototype.init=function(t,e){this.name=t,this.args=e},t.exports=e}));h(function(t){var u=c.Point2D,h=x,e={quadraticBezier:function(t,e,n,r,i,o){return new h("Bezier2",[new u(t,e),new u(n,r),new u(i,o)])},cubicBezier:function(t,e,n,r,i,o,s,a){return new h("Bezier3",[new u(t,e),new u(n,r),new u(i,o),new u(s,a)])},circle:function(t,e,n){return new h("Circle",[new u(t,e),n])},ellipse:function(t,e,n,r){return new h("Ellipse",[new u(t,e),n,r])},line:function(t,e,n,r){return new h("Line",[new u(t,e),new u(n,r)])},path:function(t){return new h("Path",t)},polygon:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new h("Polygon",[e])},polyline:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new h("Polyline",[e])},rectangle:function(t,e,n,r){return new h("Rectangle",[new u(t,e),new u(t+n,e+r)])}};t.exports=e}),h(function(t){var i=x,e={quadraticBezier:function(t,e,n){return new i("Bezier2",[t,e,n])},cubicBezier:function(t,e,n,r){return new i("Bezier3",[t,e,n,r])},circle:function(t,e){return new i("Circle",[t,e])},ellipse:function(t,e,n){return new i("Ellipse",[t,e,n])},line:function(t,e){return new i("Line",[t,e])},path:function(t){return new i("Path",[t])},polygon:function(t){return new i("Polygon",[t])},polyline:function(t){return new i("Polyline",[t])},rectangle:function(t,e){return new i("Rectangle",[t,t.add(e)])}};t.exports=e}),h(function(t){var e={pointInCircle:function(t,e,n){return Vector2D.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,r){var i=t.subtract(e);return i.x*i.x/(n*n)+i.y*i.y/(r*r)<=1},pointInPolyline:function(t,e){for(var n,r=e.length,i=0,o=e[0],s=1;s<=r;s++){var a=e[s%r],u=Math.min(o.y,a.y),h=Math.max(o.y,a.y),c=Math.max(o.x,a.x);o.y!=a.y&&u<t.y&&t.y<=h&&t.x<=c&&(n=(t.y-o.y)*(a.x-o.x)/(a.y-o.y)+o.x,(o.x==a.x||t.x<=n)&&i++),o=a}return i%2==1}};e.pointInPolygon=e.pointInPolyline,e.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&topleft.y<=t.y&&t.y<n.y},t.exports=e});var v=function(){this.__data__=[],this.size=0};var d=function(t,e){return t===e||t!=t&&e!=e};var g=function(t,e){for(var n=t.length;n--;)if(d(t[n][0],e))return n;return-1},m=Array.prototype.splice;var b=function(t){var e=this.__data__,n=g(e,t);return!(n<0||(n==e.length-1?e.pop():m.call(e,n,1),--this.size,0))};var w=function(t){var e=this.__data__,n=g(e,t);return n<0?void 0:e[n][1]};var _=function(t){return-1<g(this.__data__,t)};var P=function(t,e){var n=this.__data__,r=g(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function M(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}M.prototype.clear=v,M.prototype.delete=b,M.prototype.get=w,M.prototype.has=_,M.prototype.set=P;var I=M;var j=function(){this.__data__=new I,this.size=0};var E=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var R=function(t){return this.__data__.get(t)};var k=function(t){return this.__data__.has(t)},S="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(u)&&u&&u.Object===Object&&u,L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O="object"==("undefined"==typeof self?"undefined":L(self))&&self&&self.Object===Object&&self,N=S||O||Function("return this")(),z=N.Symbol,T=Object.prototype,A=T.hasOwnProperty,C=T.toString,B=z?z.toStringTag:void 0;var D=function(t){var e=A.call(t,B),n=t[B];try{var r=!(t[B]=void 0)}catch(t){}var i=C.call(t);return r&&(e?t[B]=n:delete t[B]),i},G=Object.prototype.toString;var X=function(t){return G.call(t)},q=z?z.toStringTag:void 0;var F=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":q&&q in Object(t)?D(t):X(t)},W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var U=function(t){var e=void 0===t?"undefined":W(t);return null!=t&&("object"==e||"function"==e)};var V,Y=function(t){if(!U(t))return!1;var e=F(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},$=N["__core-js_shared__"],H=(V=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";var Q=function(t){return!!H&&H in t},J=Function.prototype.toString;var K=function(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Z=/^\[object .+?Constructor\]$/,tt=Function.prototype,et=Object.prototype,nt=tt.toString,rt=et.hasOwnProperty,it=RegExp("^"+nt.call(rt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ot=function(t){return!(!U(t)||Q(t))&&(Y(t)?it:Z).test(K(t))};var st=function(t,e){return null==t?void 0:t[e]};var at=function(t,e){var n=st(t,e);return ot(n)?n:void 0},ut=at(N,"Map"),ht=at(Object,"create");var ct=function(){this.__data__=ht?ht(null):{},this.size=0};var lt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},pt=Object.prototype.hasOwnProperty;var yt=function(t){var e=this.__data__;if(ht){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return pt.call(e,t)?e[t]:void 0},ft=Object.prototype.hasOwnProperty;var xt=function(t){var e=this.__data__;return ht?void 0!==e[t]:ft.call(e,t)};var vt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ht&&void 0===e?"__lodash_hash_undefined__":e,this};function dt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}dt.prototype.clear=ct,dt.prototype.delete=lt,dt.prototype.get=yt,dt.prototype.has=xt,dt.prototype.set=vt;var gt=dt;var mt=function(){this.size=0,this.__data__={hash:new gt,map:new(ut||I),string:new gt}},bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var wt=function(t){var e=void 0===t?"undefined":bt(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var _t=function(t,e){var n=t.__data__;return wt(e)?n["string"==typeof e?"string":"hash"]:n.map};var Pt=function(t){var e=_t(this,t).delete(t);return this.size-=e?1:0,e};var Mt=function(t){return _t(this,t).get(t)};var It=function(t){return _t(this,t).has(t)};var jt=function(t,e){var n=_t(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Et(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Et.prototype.clear=mt,Et.prototype.delete=Pt,Et.prototype.get=Mt,Et.prototype.has=It,Et.prototype.set=jt;var Rt=Et;var kt=function(t,e){var n=this.__data__;if(n instanceof I){var r=n.__data__;if(!ut||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Rt(r)}return n.set(t,e),this.size=n.size,this};function St(t){var e=this.__data__=new I(t);this.size=e.size}St.prototype.clear=j,St.prototype.delete=E,St.prototype.get=R,St.prototype.has=k,St.prototype.set=kt;var Lt=St;var Ot=function(t){return this.__data__.has(t)};function Nt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Rt;++e<n;)this.add(t[e])}Nt.prototype.add=Nt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Nt.prototype.has=Ot;var zt=Nt;var Tt=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var At=function(t,e){return t.has(e)};var Ct=function(t,e,n,r,i,o){var s=1&n,a=t.length,u=e.length;if(a!=u&&!(s&&a<u))return!1;var h=o.get(t);if(h&&o.get(e))return h==e;var c=-1,l=!0,p=2&n?new zt:void 0;for(o.set(t,e),o.set(e,t);++c<a;){var y=t[c],f=e[c];if(r)var x=s?r(f,y,c,e,t,o):r(y,f,c,t,e,o);if(void 0!==x){if(x)continue;l=!1;break}if(p){if(!Tt(e,function(t,e){if(!At(p,e)&&(y===t||i(y,t,n,r,o)))return p.push(e)})){l=!1;break}}else if(y!==f&&!i(y,f,n,r,o)){l=!1;break}}return o.delete(t),o.delete(e),l},Bt=N.Uint8Array;var Dt=function(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r};var Gt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},Xt=z?z.prototype:void 0,qt=Xt?Xt.valueOf:void 0;var Ft=function(t,e,n,r,i,o,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new Bt(t),new Bt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return d(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Dt;case"[object Set]":var u=1&r;if(a||(a=Gt),t.size!=e.size&&!u)return!1;var h=s.get(t);if(h)return h==e;r|=2,s.set(t,e);var c=Ct(a(t),a(e),r,i,o,s);return s.delete(t),c;case"[object Symbol]":if(qt)return qt.call(t)==qt.call(e)}return!1};var Wt=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},Ut=Array.isArray;var Vt=function(t,e,n){var r=e(t);return Ut(t)?r:Wt(r,n(t))};var Yt=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o};var $t=function(){return[]},Ht=Object.prototype.propertyIsEnumerable,Qt=Object.getOwnPropertySymbols,Jt=Qt?function(e){return null==e?[]:(e=Object(e),Yt(Qt(e),function(t){return Ht.call(e,t)}))}:$t;var Kt=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var te=function(t){return null!=t&&"object"==(void 0===t?"undefined":Zt(t))};var ee=function(t){return te(t)&&"[object Arguments]"==F(t)},ne=Object.prototype,re=ne.hasOwnProperty,ie=ne.propertyIsEnumerable,oe=ee(function(){return arguments}())?ee:function(t){return te(t)&&re.call(t,"callee")&&!ie.call(t,"callee")};var se=function(){return!1},ae=h(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?N.Buffer:void 0,o=(i?i.isBuffer:void 0)||se;t.exports=o}),ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},he=/^(?:0|[1-9]\d*)$/;var ce=function(t,e){var n=void 0===t?"undefined":ue(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&he.test(t))&&-1<t&&t%1==0&&t<e};var le=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},pe={};pe["[object Float32Array]"]=pe["[object Float64Array]"]=pe["[object Int8Array]"]=pe["[object Int16Array]"]=pe["[object Int32Array]"]=pe["[object Uint8Array]"]=pe["[object Uint8ClampedArray]"]=pe["[object Uint16Array]"]=pe["[object Uint32Array]"]=!0,pe["[object Arguments]"]=pe["[object Array]"]=pe["[object ArrayBuffer]"]=pe["[object Boolean]"]=pe["[object DataView]"]=pe["[object Date]"]=pe["[object Error]"]=pe["[object Function]"]=pe["[object Map]"]=pe["[object Number]"]=pe["[object Object]"]=pe["[object RegExp]"]=pe["[object Set]"]=pe["[object String]"]=pe["[object WeakMap]"]=!1;var ye=function(t){return te(t)&&le(t.length)&&!!pe[F(t)]};var fe=function(e){return function(t){return e(t)}},xe=h(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n&&S.process,o=function(){try{var t=r&&r.require&&r.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=o}),ve=xe&&xe.isTypedArray,de=ve?fe(ve):ye,ge=Object.prototype.hasOwnProperty;var me=function(t,e){var n=Ut(t),r=!n&&oe(t),i=!n&&!r&&ae(t),o=!n&&!r&&!i&&de(t),s=n||r||i||o,a=s?Kt(t.length,String):[],u=a.length;for(var h in t)!e&&!ge.call(t,h)||s&&("length"==h||i&&("offset"==h||"parent"==h)||o&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||ce(h,u))||a.push(h);return a},be=Object.prototype;var we=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||be)};var _e=function(e,n){return function(t){return e(n(t))}}(Object.keys,Object),Pe=Object.prototype.hasOwnProperty;var Me=function(t){if(!we(t))return _e(t);var e=[];for(var n in Object(t))Pe.call(t,n)&&"constructor"!=n&&e.push(n);return e};var Ie=function(t){return null!=t&&le(t.length)&&!Y(t)};var je=function(t){return Ie(t)?me(t):Me(t)};var Ee=function(t){return Vt(t,je,Jt)},Re=Object.prototype.hasOwnProperty;var ke=function(t,e,n,r,i,o){var s=1&n,a=Ee(t),u=a.length;if(u!=Ee(e).length&&!s)return!1;for(var h=u;h--;){var c=a[h];if(!(s?c in e:Re.call(e,c)))return!1}var l=o.get(t);if(l&&o.get(e))return l==e;var p=!0;o.set(t,e),o.set(e,t);for(var y=s;++h<u;){var f=t[c=a[h]],x=e[c];if(r)var v=s?r(x,f,c,e,t,o):r(f,x,c,t,e,o);if(!(void 0===v?f===x||i(f,x,n,r,o):v)){p=!1;break}y||(y="constructor"==c)}if(p&&!y){var d=t.constructor,g=e.constructor;d!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof d&&d instanceof d&&"function"==typeof g&&g instanceof g)&&(p=!1)}return o.delete(t),o.delete(e),p},Se=at(N,"DataView"),Le=at(N,"Promise"),Oe=at(N,"Set"),Ne=at(N,"WeakMap"),ze="[object Map]",Te="[object Promise]",Ae="[object Set]",Ce="[object WeakMap]",Be="[object DataView]",De=K(Se),Ge=K(ut),Xe=K(Le),qe=K(Oe),Fe=K(Ne),We=F;(Se&&We(new Se(new ArrayBuffer(1)))!=Be||ut&&We(new ut)!=ze||Le&&We(Le.resolve())!=Te||Oe&&We(new Oe)!=Ae||Ne&&We(new Ne)!=Ce)&&(We=function(t){var e=F(t),n="[object Object]"==e?t.constructor:void 0,r=n?K(n):"";if(r)switch(r){case De:return Be;case Ge:return ze;case Xe:return Te;case qe:return Ae;case Fe:return Ce}return e});var Ue=We,Ve="[object Arguments]",Ye="[object Array]",$e="[object Object]",He=Object.prototype.hasOwnProperty;var Qe=function(t,e,n,r,i,o){var s=Ut(t),a=Ut(e),u=s?Ye:Ue(t),h=a?Ye:Ue(e),c=(u=u==Ve?$e:u)==$e,l=(h=h==Ve?$e:h)==$e,p=u==h;if(p&&ae(t)){if(!ae(e))return!1;c=!(s=!0)}if(p&&!c)return o||(o=new Lt),s||de(t)?Ct(t,e,n,r,i,o):Ft(t,e,u,n,r,i,o);if(!(1&n)){var y=c&&He.call(t,"__wrapped__"),f=l&&He.call(e,"__wrapped__");if(y||f){var x=y?t.value():t,v=f?e.value():e;return o||(o=new Lt),i(x,v,n,r,o)}}return!!p&&(o||(o=new Lt),ke(t,e,n,r,i,o))};var Je=function t(e,n,r,i,o){return e===n||(null==e||null==n||!te(e)&&!te(n)?e!=e&&n!=n:Qe(e,n,r,i,t,o))};var Ke=function(t,e){return Je(t,e)};function Ze(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(e,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,e))}var tn=function(n){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,n.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._layerTMP=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP_TMP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}return Ze(r,n),r.prototype.intersection=function(t,e){var n=this;if(this._checkAvailGeoType(t))return this._initialTaskWithGeo(t,"intersection"),this._compositTargets(e,function(t){console.log(t),n.remove()}),this},r.prototype.union=function(t,e){var n=this;if(this._checkAvailGeoType(t))return this._initialTaskWithGeo(t,"union"),this._compositTargets(e,function(t){console.log(t),n.remove()}),this},r.prototype.diff=function(t,e){var n=this;if(this._checkAvailGeoType(t))return this._initialTaskWithGeo(t,"diff"),this._compositTargets(e,function(t){console.log(t),n.remove()}),this},r.prototype.xor=function(t,e){var n=this;if(this._checkAvailGeoType(t))return this._initialTaskWithGeo(t,"xor"),this._compositTargets(e,function(t){console.log(t),n.remove()}),this},r.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};switch(this._task){case"intersection":this._intersectionWithTargets();break;case"union":this._unionWithTargets();break;case"diff":this._diffWithTargets();break;case"xor":this._xorWithTargets()}t(this._result,this._deals),this.remove()},r.prototype.cancel=function(){this.remove()},r.prototype.remove=function(){this._map;this._tmpLayer&&this._tmpLayer.remove(),this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._tmpLayer,delete this._chooseLayer,delete this._mousemove,delete this._click,delete this._dblclick},r.prototype._checkAvailGeoType=function(t){return t instanceof maptalks.Polygon||t instanceof maptalks.MultiPolygon},r.prototype._compositTargets=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return!1},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){return!1};this._checkAvailGeoType(t)&&(t=[t]),t instanceof Array&&0<t.length?e(t):n(t)},r.prototype._initialTaskWithGeo=function(t,e){this._insureSafeTask(),this._task=e,this._savePrivateGeometry(t)},r.prototype._insureSafeTask=function(){map._map_tool&&drawTool instanceof maptalks.DrawTool&&drawTool.disable(),this.geometry&&this.remove()},r.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},r.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),this._map=t,this._tmpLayer=new maptalks.VectorLayer(this._layerTMP).addTo(t).bringToFront(),this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},r.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},r.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},r.prototype._mousemoveEvents=function(t){var n=this,r=[],i=this._getSafeCoords();this.layer.identify(t.coordinate).forEach(function(t){var e=n._getSafeCoords(t);!Ke(e,i)&&n._checkAvailGeoType(t)&&r.push(t)}),this._updateHitGeo(r)},r.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var n=t.options,r=n.numberOfShellPoints;n.numberOfShellPoints=300,t.setOptions(n),e=[t.getShell()],n.numberOfShellPoints=r||60,t.setOptions(n)}return e},r.prototype._updateHitGeo=function(t){if(this._needRefreshSymbol){var e=this._chooseLayer.getGeometryById("_hit");e&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length){this._needRefreshSymbol=!0,this.hitGeo=t[0];var n=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,n).setId("_hit")}},r.prototype._getSymbolOrDefault=function(t,e){var n=t.getSymbol(),r=this["_color"+e];if(n){for(var i in n)(i.endsWith("Fill")||i.endsWith("Color"))&&(n[i]=r);n.lineWidth=4}else n={lineColor:r,lineWidth:4};return n},r.prototype._copyGeoUpdateSymbol=function(t,e){return t.copy().updateSymbol(e).addTo(this._chooseLayer)},r.prototype._clickEvents=function(t){if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}},r.prototype._setChooseGeosExceptHit=function(n,t){var r=this,i=[];this._chooseGeos.forEach(function(t){var e=r._getSafeCoords(t);Ke(n,e)||i.push(t)}),t||i.length!==this._chooseGeos.length?this._chooseGeos=i:this._chooseGeos.push(this.hitGeo)},r.prototype._updateChooseGeos=function(){var n=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=n._getSymbolOrDefault(t,"Choose");n._copyGeoUpdateSymbol(t,e)})},r.prototype._intersectionWithTargets=function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos},r.prototype._unionWithTargets=function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos},r.prototype._diffWithTargets=function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos},r.prototype._xorWithTargets=function(){0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos},r}(maptalks.Class);tn.mergeOptions({}),t.PolygonBool=tn,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.polygonbool v0.1.0-alpha.1")});