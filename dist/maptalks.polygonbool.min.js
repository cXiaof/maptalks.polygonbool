/*!
 * maptalks.polygonbool v0.1.0
 * LICENSE : MIT
 * (c) 2016-2021 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e){return e<t?1:t<e?-1:0}var c=(i.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e},i.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e},i.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e)}},i.prototype.splay=function(t){for(var e,r,n,o;t.parent;)(r=(e=t.parent).parent)&&r.parent?((o=r.parent).left===r?o.left=t:o.right=t,t.parent=o):(t.parent=null,this._root=t),n=t.left,o=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,(e.right=r).parent=e):(n?(r.right=n).parent=r:r.right=null,(t.left=r).parent=t)),o?(e.left=o).parent=e:e.left=null,(t.right=e).parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,(e.left=r).parent=e):(o?(r.left=o).parent=r:r.left=null,(t.right=r).parent=t)),n?(e.right=n).parent=e:e.right=null,(t.left=e).parent=t)},i.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent)},i.prototype.minNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t},i.prototype.insert=function(t,e){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(0===o((n=r).key,t))return;r=o(r.key,t)<0?r.right:r.left}else for(;r;)r=o((n=r).key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?o(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},i.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else{if(!(0<n))return e;e=e.left}}return null},i.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},i.prototype.remove=function(t){var e=this.find(t);return!!e&&(this.splay(e),e.left?e.right?((t=this.minNode(e.right)).parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t):this.replace(e,e.left):this.replace(e,e.right),this._size--,!0)},i.prototype.removeNode=function(t){return!!t&&(this.splay(t),t.left?t.right?((e=this.minNode(t.right)).parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e):this.replace(t,t.left):this.replace(t,t.right),this._size--,!0);var e},i.prototype.erase=function(t){var e,r=this.find(t);r&&(this.splay(r),e=r.left,t=r.right,r=null,e&&(e.parent=null,r=this.maxNode(e),this.splay(r),this._root=r),t&&(e?r.right=t:this._root=t,t.parent=r),this._size--)},i.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key)}return e},i.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)e=(t=e).parent;return e},i.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)e=(t=e).parent;return e},i.prototype.forEach=function(t){for(var e=this._root,r=[],n=!1,o=0;!n;)e?(r.push(e),e=e.left):0<r.length?(t(e=r.pop(),o++),e=e.right):n=!0;return this},i.prototype.range=function(t,e,r,n){for(var o=[],i=this._compare,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(0<i((s=o.pop()).key,e))break;if(0<=i(s.key,t)&&r.call(n,s))return this;s=s.right}return this},i.prototype.keys=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r},i.prototype.values=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):0<e.length?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r},i.prototype.at=function(t){for(var e=this._root,r=[],n=!1,o=0;!n;)if(e)r.push(e),e=e.left;else if(0<r.length){if(e=r.pop(),o===t)return e;o++,e=e.right}else n=!0;return null},i.prototype.load=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(0!==this._size)throw new Error("bulk-load: tree is not empty");var n=t.length;return r&&function t(e,r,n,o,i){if(o<=n)return;var s=e[n+o>>1];var a=n-1;var u=o+1;for(;;){for(;i(e[++a],s)<0;);for(;0<i(e[--u],s););if(u<=a)break;var h=e[a];e[a]=e[u],e[u]=h,h=r[a],r[a]=r[u],r[u]=h}t(e,r,n,u,i);t(e,r,u+1,o,i)}(t,e,0,n-1,this._compare),this._root=function t(e,r,n,o,i){var s=i-o;if(0<s){var a=o+Math.floor(s/2),u=r[a],s=n[a],e={key:u,data:s,parent:e};return e.left=t(e,r,n,o,a),e.right=t(e,r,n,a+1,i),e}return null}(null,t,e,0,n),this._size=n,this},i.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},i.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},i.prototype.isEmpty=function(){return null===this._root},i.createTree=function(t,e,r,n,o){return new i(r,o).load(t,e,n)},e(i,[{key:"size",get:function(){return this._size}}]),i);function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!e}var s=0,a=1,u=2,h=3,v=0,f=1,y=2,p=3;function _(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!o(e,r)||e.isVertical()?e.prevInResult:e)),t.inResult=o(t,r)}function o(t,e){switch(t.type){case s:switch(e){case v:return!t.otherInOut;case f:return t.otherInOut;case y:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case p:return!0}break;case u:return e===v||e===f;case h:return e===y;case a:return!1}return!1}var d=(l.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?0<(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]):0<(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])},l.prototype.isAbove=function(t){return!this.isBelow(t)},l.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},l.prototype.clone=function(){var t=new l(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.inResult=this.inResult,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},l);function l(t,e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=o||s,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.inResult=!1,this.resultInOut=!1,this.isExteriorRing=!0}function g(t,e){return t[0]===e[0]&&t[1]===e[1]}function b(t,e,r){return(t[0]-r[0])*(e[1]-r[1])-(e[0]-r[0])*(t[1]-r[1])}function m(t,e){var r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:(e=e,r=r,(t=t).left!==e.left?t.left?1:-1:0===b(r,t.otherEvent.point,e.otherEvent.point)?!t.isSubject&&e.isSubject?1:-1:t.isBelow(e.otherEvent.point)?-1:1)}function k(t,e,r){var n=new d(e,!1,t,t.isSubject),e=new d(e,!0,t.otherEvent,t.isSubject);return g(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=e.contourId=t.contourId,0<m(e,t.otherEvent)&&(t.otherEvent.left=!0,e.left=!1),t.otherEvent.otherEvent=e,t.otherEvent=n,r.push(e),r.push(n),r}function E(t,e){return t[0]*e[1]-t[1]*e[0]}function O(t,e){return t[0]*e[0]+t[1]*e[1]}var j=function(t,e,r,n,o){var i=[e[0]-t[0],e[1]-t[1]],s=[n[0]-r[0],n[1]-r[1]];function a(t,e,r){return[t[0]+e*r[0],t[1]+e*r[1]]}var u=[r[0]-t[0],r[1]-t[1]],h=E(i,s),l=h*h,f=O(i,i);if(0<l){e=E(u,s)/h;if(e<0||1<e)return null;n=E(u,i)/h;return n<0||1<n?null:0==e||1==e?o?null:[a(t,e,i)]:0==n||1==n?o?null:[a(r,n,s)]:[a(t,e,i)]}if(0<(h=E(u,i))*h)return null;u=O(i,u)/f,s=u+O(i,s)/f,f=Math.min(u,s),s=Math.max(u,s);return f<=1&&0<=s?1===f?o?null:[a(t,0<f?f:0,i)]:0===s?o?null:[a(t,s<1?s:1,i)]:o&&0===f&&1===s?null:[a(t,0<f?f:0,i),a(t,s<1?s:1,i)]:null};function w(t,e,r){var n=j(t.point,t.otherEvent.point,e.point,e.otherEvent.point),o=n?n.length:0;if(0===o)return 0;if(1===o&&(g(t.point,e.point)||g(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===o&&t.isSubject===e.isSubject)return 0;if(1===o)return g(t.point,n[0])||g(t.otherEvent.point,n[0])||k(t,n[0],r),g(e.point,n[0])||g(e.otherEvent.point,n[0])||k(e,n[0],r),1;var i=[],o=!1,n=!1;return g(t.point,e.point)?o=!0:1===m(t,e)?i.push(e,t):i.push(t,e),g(t.otherEvent.point,e.otherEvent.point)?n=!0:1===m(t.otherEvent,e.otherEvent)?i.push(e.otherEvent,t.otherEvent):i.push(t.otherEvent,e.otherEvent),o&&n||o?(e.type=a,t.type=e.inOut===t.inOut?u:h,o&&!n&&k(i[1].otherEvent,i[0].point,r),2):(n?k(i[0],i[1].point,r):i[0]!==i[3].otherEvent?(k(i[0],i[1].point,r),k(i[1],i[2].point,r)):(k(i[0],i[1].point,r),k(i[3].otherEvent,i[2].point,r)),3)}function S(t,e){if(t===e)return 0;if(0!==b(t.point,t.otherEvent.point,e.point)||0!==b(t.point,t.otherEvent.point,e.otherEvent.point))return g(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===m(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,n=e.point;return r[0]===n[0]&&r[1]===n[1]?(r=t.otherEvent.point,n=e.otherEvent.point,r[0]===n[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1):1===m(t,e)?1:-1}function G(t,e){for(var r=void 0,n=function(t){for(var e=void 0,r=void 0,n=void 0,o=void 0,i=[],r=0,n=t.length;r<n;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&i.push(e);for(var s=!1;!s;)for(s=!0,r=0,n=i.length;r<n;r++)r+1<n&&1===m(i[r],i[r+1])&&(o=i[r],i[r]=i[r+1],i[r+1]=o,s=!1);for(r=0,n=i.length;r<n;r++)(e=i[r]).pos=r;for(r=0,n=i.length;r<n;r++)(e=i[r]).left||(o=e.pos,e.pos=e.otherEvent.pos,e.otherEvent.pos=o);return i}(t),o={},i=[],s=void 0,r=0,a=n.length;r<a;r++)if(!o[r]){var u=[[]];n[r].isExteriorRing?e===y&&!n[r].isSubject&&1<i.length?i[i.length-1].push(u[0]):i.push(u):e!==y||n[r].isSubject||0!==i.length?0===i.length?i.push([[u]]):i[i.length-1].push(u[0]):i.push(u);var h=i.length-1,l=r,f=n[r].point;for(u[0].push(f);r<=l;)s=n[l],o[l]=!0,s.left?(s.resultInOut=!1,s.contourId=h):(s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h),o[l=s.pos]=!0,u[0].push(n[l].point),l=function(t,e,r,n){var o=void 0,i=t+1,s=e.length,a=e[t].point;for(i<s&&(o=e[i].point);i<s&&o[0]===a[0]&&o[1]===a[1];){if(!r[i])return i;o=e[++i].point}for(i=t-1;r[i]&&n<=i;)i--;return i}(l,n,o,r);s=n[l=-1===l?r:l],o[l]=o[s.pos]=!0,s.otherEvent.resultInOut=!0,s.otherEvent.contourId=h}return i}var I=x,e=x;function x(t,e){if(!(this instanceof x))return new x(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||R,0<this.length)for(var r=(this.length>>1)-1;0<=r;r--)this._down(r)}function R(t,e){return t<e?-1:e<t?1:0}x.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];0<t;){var o=t-1>>1,i=e[o];if(0<=r(n,i))break;e[t]=i,t=o}e[t]=n},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,o=e[t];t<n;){var i=1+(t<<1),s=i+1,a=e[i];if(s<this.length&&r(e[s],a)<0&&(a=e[i=s]),0<=r(a,o))break;e[t]=a,t=i}e[t]=o}},I.default=e;var T=Math.max,z=Math.min,A=0;function P(t,e,r,n,o,i){for(var s=void 0,a=void 0,u=void 0,s=0,h=t.length-1;s<h;s++){var l,f,p=t[s],c=t[s+1],a=new d(p,!1,void 0,e),u=new d(c,!1,a,e);a.otherEvent=u,p[0]===c[0]&&p[1]===c[1]||(a.contourId=u.contourId=r,i||(a.isExteriorRing=!1,u.isExteriorRing=!1),0<m(a,u)?u.left=!0:a.left=!0,l=p[0],f=p[1],o[0]=z(o[0],l),o[1]=z(o[1],f),o[2]=T(o[2],l),o[3]=T(o[3],f),n.push(a),n.push(u))}}var L=[];function C(t,e,r){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var n=(i=e,o=r,a=null,(s=t).length*i.length==0&&(o===v?a=L:o===y?a=s:o!==f&&o!==p||(a=0===s.length?i:s)),a);if(n)return n===L?null:n;var o,i,s,a,u=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],l=function(t,e,r,n,o){for(var i=new I(null,m),s=void 0,a=void 0,u=void 0,h=void 0,l=void 0,f=void 0,u=0,h=t.length;u<h;u++)for(l=0,f=(s=t[u]).length;l<f;l++)(a=0===l)&&A++,P(s[l],!0,A,i,r,a);for(u=0,h=e.length;u<h;u++)for(l=0,f=(s=e[u]).length;l<f;l++)a=0===l,(a=o===y?!1:a)&&A++,P(s[l],!1,A,i,n,a);return i}(t,e,u,h,r);return o=t,i=e,s=r,a=null,((t=u)[0]>(e=h)[2]||e[0]>t[2]||t[1]>e[3]||e[1]>t[3])&&(s===v?a=L:s===y?a=o:s!==f&&s!==p||(a=o.concat(i))),(n=a)?n===L?null:n:G(function(t,e,r,n){for(var o=new c(S),i=[],s=Math.min(e[2],r[2]),a=void 0,u=void 0,h=void 0;0!==t.length;){var l,f,p=t.pop();if(i.push(p),n===v&&p.point[0]>s||n===y&&p.point[0]>e[2])break;p.left?(u=a=o.insert(p),a=a!==(h=o.minNode())?o.prev(a):null,u=o.next(u),_(p,l=a?a.key:null,n),u&&2===w(p,u.key,t)&&(_(p,l,n),_(p,u.key,n)),a&&2===w(a.key,p,t)&&(_(l,(f=(f=a)!==h?o.prev(f):null)?f.key:null,n),_(p,l,n))):(p=p.otherEvent,u=a=o.find(p),a&&u&&(a=a!==h?o.prev(a):null,u=o.next(u),o.remove(p),u&&a&&w(a.key,u.key,t)))}return i}(l,u,h,r),r)}var Bt="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var N,Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M=(function(t,e){var n="__lodash_hash_undefined__",g=1,y=2,p=9007199254740991,f="[object Arguments]",c="[object Array]",r="[object AsyncFunction]",v="[object Boolean]",_="[object Date]",d="[object Error]",o="[object Function]",i="[object GeneratorFunction]",b="[object Map]",m="[object Number]",s="[object Null]",k="[object Object]",a="[object Promise]",u="[object Proxy]",E="[object RegExp]",O="[object Set]",j="[object String]",w="[object Symbol]",h="[object Undefined]",l="[object WeakMap]",S="[object ArrayBuffer]",G="[object DataView]",I=/^\[object .+?Constructor\]$/,x=/^(?:0|[1-9]\d*)$/,R={};R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R[f]=R[c]=R[S]=R[v]=R[G]=R[_]=R[d]=R[o]=R[b]=R[m]=R[k]=R[E]=R[O]=R[j]=R[l]=!1;var T="object"==Ut(Bt)&&Bt&&Bt.Object===Object&&Bt,z="object"==("undefined"==typeof self?"undefined":Ut(self))&&self&&self.Object===Object&&self,A=T||z||Function("return this")(),P=e&&!e.nodeType&&e,L=P&&t&&!t.nodeType&&t,C=L&&L.exports===P,N=C&&T.process,z=function(){try{return N&&N.binding&&N.binding("util")}catch(t){}}(),e=z&&z.isTypedArray;function M(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function B(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var U,D,L=Array.prototype,P=Function.prototype,F=Object.prototype,T=A["__core-js_shared__"],W=P.toString,$=F.hasOwnProperty,H=(z=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"",V=F.toString,J=RegExp("^"+W.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=C?A.Buffer:void 0,T=A.Symbol,Y=A.Uint8Array,q=F.propertyIsEnumerable,X=L.splice,K=T?T.toStringTag:void 0,Q=Object.getOwnPropertySymbols,z=P?P.isBuffer:void 0,Z=(U=Object.keys,D=Object,function(t){return U(D(t))}),C=jt(A,"DataView"),tt=jt(A,"Map"),L=jt(A,"Promise"),P=jt(A,"Set"),A=jt(A,"WeakMap"),et=jt(Object,"create"),rt=Gt(C),nt=Gt(tt),ot=Gt(L),it=Gt(P),st=Gt(A),T=T?T.prototype:void 0,at=T?T.valueOf:void 0;function ut(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ht(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function lt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ft(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new lt;++e<r;)this.add(t[e])}function pt(t){t=this.__data__=new ht(t);this.size=t.size}function ct(t,e){var r,n,o,i=Rt(t),s=!i&&xt(t),a=!i&&!s&&Tt(t),u=!i&&!s&&!a&&Nt(t),h=i||s||a||u,l=h?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],f=l.length;for(r in t)!e&&!$.call(t,r)||h&&("length"==r||a&&("offset"==r||"parent"==r)||u&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,!!(o=null==(o=f)?p:o)&&("number"==typeof n||x.test(n))&&-1<n&&n%1==0&&n<o))||l.push(r);return l}function vt(t,e){for(var r=t.length;r--;)if(It(t[r][0],e))return r;return-1}function yt(t,e,r){e=e(t);return Rt(t)?e:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(e,r(t))}function _t(t){return null==t?void 0===t?h:s:K&&K in Object(t)?function(t){var e=$.call(t,K),r=t[K];try{var n=!(t[K]=void 0)}catch(t){}var o=V.call(t);n&&(e?t[K]=r:delete t[K]);return o}(t):(t=t,V.call(t))}function dt(t){return Lt(t)&&_t(t)==f}function gt(t,e,r,n,o){return t===e||(null==t||null==e||!Lt(t)&&!Lt(e)?t!=t&&e!=e:function(t,e,r,n,o,i){var s=Rt(t),a=Rt(e),u=s?c:St(t),h=a?c:St(e),l=(u=u==f?k:u)==k,a=(h=h==f?k:h)==k,h=u==h;if(h&&Tt(t)){if(!Tt(e))return!1;l=!(s=!0)}if(h&&!l)return i=i||new pt,s||Nt(t)?kt(t,e,r,n,o,i):function(t,e,r,n,o,i,s){switch(r){case G:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S:return t.byteLength==e.byteLength&&i(new Y(t),new Y(e))?!0:!1;case v:case _:case m:return It(+t,+e);case d:return t.name==e.name&&t.message==e.message;case E:case j:return t==e+"";case b:var a=M;case O:var u=n&g;if(a=a||B,t.size!=e.size&&!u)return!1;u=s.get(t);if(u)return u==e;n|=y,s.set(t,e);a=kt(a(t),a(e),n,o,i,s);return s.delete(t),a;case w:if(at)return at.call(t)==at.call(e)}return!1}(t,e,u,r,n,o,i);if(!(r&g)){l=l&&$.call(t,"__wrapped__"),a=a&&$.call(e,"__wrapped__");if(l||a){l=l?t.value():t,a=a?e.value():e;return i=i||new pt,o(l,a,r,n,i)}}return h&&(i=i||new pt,function(t,e,r,n,o,i){var s=r&g,a=Et(t),u=a.length,h=Et(e).length;if(u!=h&&!s)return!1;var l=u;for(;l--;){var f=a[l];if(!(s?f in e:$.call(e,f)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var c=!0;i.set(t,e),i.set(e,t);var v=s;for(;++l<u;){f=a[l];var y,_=t[f],d=e[f];if(!(void 0===(y=n?s?n(d,_,f,e,t,i):n(_,d,f,t,e,i):y)?_===d||o(_,d,r,n,i):y)){c=!1;break}v=v||"constructor"==f}c&&!v&&(h=t.constructor,p=e.constructor,h!=p&&"constructor"in t&&"constructor"in e&&!("function"==typeof h&&h instanceof h&&"function"==typeof p&&p instanceof p)&&(c=!1));return i.delete(t),i.delete(e),c}(t,e,r,n,o,i))}(t,e,r,n,gt,o))}function bt(t){var e;return Pt(t)&&(e=t,!(H&&H in e))&&(zt(t)?J:I).test(Gt(t))}function mt(t){if(r="function"==typeof(r=(e=t)&&e.constructor)&&r.prototype||F,e!==r)return Z(t);var e,r,n,o=[];for(n in Object(t))$.call(t,n)&&"constructor"!=n&&o.push(n);return o}function kt(t,e,n,o,i,s){var r=n&g,a=t.length,u=e.length;if(a!=u&&!(r&&a<u))return!1;u=s.get(t);if(u&&s.get(e))return u==e;var h=-1,l=!0,f=n&y?new ft:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p,c=t[h],v=e[h];if(void 0!==(p=o?r?o(v,c,h,e,t,s):o(c,v,h,t,e,s):p)){if(p)continue;l=!1;break}if(f){if(!function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return 1}(e,function(t,e){return r=e,!f.has(r)&&(c===t||i(c,t,n,o,s))&&f.push(e);var r})){l=!1;break}}else if(c!==v&&!i(c,v,n,o,s)){l=!1;break}}return s.delete(t),s.delete(e),l}function Et(t){return yt(t,Mt,wt)}function Ot(t,e){var r,n=t.__data__;return("string"==(t=void 0===(r=e)?"undefined":Ut(r))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function jt(t,e){e=e,e=null==(t=t)?void 0:t[e];return bt(e)?e:void 0}ut.prototype.clear=function(){this.__data__=et?et(null):{},this.size=0},ut.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},ut.prototype.get=function(t){var e=this.__data__;if(et){var r=e[t];return r===n?void 0:r}return $.call(e,t)?e[t]:void 0},ut.prototype.has=function(t){var e=this.__data__;return et?void 0!==e[t]:$.call(e,t)},ut.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=et&&void 0===e?n:e,this},ht.prototype.clear=function(){this.__data__=[],this.size=0},ht.prototype.delete=function(t){var e=this.__data__;return!((t=vt(e,t))<0)&&(t==e.length-1?e.pop():X.call(e,t,1),--this.size,!0)},ht.prototype.get=function(t){var e=this.__data__;return(t=vt(e,t))<0?void 0:e[t][1]},ht.prototype.has=function(t){return-1<vt(this.__data__,t)},ht.prototype.set=function(t,e){var r=this.__data__,n=vt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this},lt.prototype.clear=function(){this.size=0,this.__data__={hash:new ut,map:new(tt||ht),string:new ut}},lt.prototype.delete=function(t){return t=Ot(this,t).delete(t),this.size-=t?1:0,t},lt.prototype.get=function(t){return Ot(this,t).get(t)},lt.prototype.has=function(t){return Ot(this,t).has(t)},lt.prototype.set=function(t,e){var r=Ot(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},ft.prototype.add=ft.prototype.push=function(t){return this.__data__.set(t,n),this},ft.prototype.has=function(t){return this.__data__.has(t)},pt.prototype.clear=function(){this.__data__=new ht,this.size=0},pt.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},pt.prototype.get=function(t){return this.__data__.get(t)},pt.prototype.has=function(t){return this.__data__.has(t)},pt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof ht){var n=r.__data__;if(!tt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new lt(n)}return r.set(t,e),this.size=r.size,this};var wt=Q?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i}(Q(e),function(t){return q.call(e,t)}))}:function(){return[]},St=_t;function Gt(t){if(null!=t){try{return W.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function It(t,e){return t===e||t!=t&&e!=e}(C&&St(new C(new ArrayBuffer(1)))!=G||tt&&St(new tt)!=b||L&&St(L.resolve())!=a||P&&St(new P)!=O||A&&St(new A)!=l)&&(St=function(t){var e=_t(t),t=e==k?t.constructor:void 0,t=t?Gt(t):"";if(t)switch(t){case rt:return G;case nt:return b;case ot:return a;case it:return O;case st:return l}return e});var xt=dt(function(){return arguments}())?dt:function(t){return Lt(t)&&$.call(t,"callee")&&!q.call(t,"callee")},Rt=Array.isArray;var Tt=z||function(){return!1};function zt(t){if(Pt(t)){t=_t(t);return t==o||t==i||t==r||t==u}}function At(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=p}function Pt(t){var e=void 0===t?"undefined":Ut(t);return null!=t&&("object"==e||"function"==e)}function Lt(t){return null!=t&&"object"==(void 0===t?"undefined":Ut(t))}var Ct,Nt=e?(Ct=e,function(t){return Ct(t)}):function(t){return Lt(t)&&At(t.length)&&!!R[_t(t)]};function Mt(t){return(null!=(e=t)&&At(e.length)&&!zt(e)?ct:mt)(t);var e}t.exports=function(t,e){return gt(t,e)}}(N={exports:{}},N.exports),N.exports);var B=function(t){var e=t?t.length:0;return e?function(t,e,r){var n=-1,o=t.length;(r=o<r?o:r)<0&&(r+=o),o=r<(e=e<0?o<-e?0:o+e:e)?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i}(t,1,e):[]};function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var D,e=(U(F,D=maptalks.Class),F.prototype.intersection=function(t,e){return this._setTaskSafety("intersection"),this._initialTask(t,e)},F.prototype.union=function(t,e){return this._setTaskSafety("union"),this._initialTask(t,e)},F.prototype.diff=function(t,e){return this._setTaskSafety("diff"),this._initialTask(t,e)},F.prototype.xor=function(t,e){return this._setTaskSafety("xor"),this._initialTask(t,e)},F.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1},e=B(this._chooseGeos);return t(this._dealWithTargets(e),this._deals,this._task),this.remove(),this},F.prototype.cancel=function(){return this.remove(),this},F.prototype.remove=function(){this._map;return this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._chooseLayer,delete this._mousemove,delete this._click,this},F.prototype._setTaskSafety=function(t){this.geometry&&this.remove();this._task=t,this._boolType=["intersection","union","diff","xor"].indexOf(t)},F.prototype._initialTask=function(t,e){if(this._checkAvailGeoType(t)){if(void 0!==e){this.geometry=t,this._checkAvailGeoType(e)&&(e=[e]);var r=t.copy();return e instanceof Array&&0<e.length&&(r=this._dealWithTargets(e)),this.remove(),r}this._savePrivateGeometry(t),this._chooseGeos=[t],this._updateChooseGeos()}},F.prototype._checkAvailGeoType=function(t){return t instanceof maptalks.Polygon||t instanceof maptalks.MultiPolygon},F.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t.getLayer(),this._addTo(t.getMap())},F.prototype._addTo=function(t){this._chooseLayer&&this.remove(),t._map_tool&&t._map_tool instanceof maptalks.DrawTool&&t._map_tool.disable(),this._map=t,this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents()},F.prototype._registerMapEvents=function(){var t;this._mousemove||(t=this._map,this._mousemove=this._mousemoveEvents.bind(this),this._click=this._clickEvents.bind(this),t.on("mousemove",this._mousemove,this),t.on("click",this._click,this))},F.prototype._offMapEvents=function(){var t;this._mousemove&&((t=this._map).off("mousemove",this._mousemove,this),t.off("click",this._click,this))},F.prototype._mousemoveEvents=function(t){var r=this,n=[],o=this._getSafeCoords();t.target.identify({coordinate:t.coordinate,tolerance:1e-4,layers:[this.layer.getId()].concat(this.options.alterNative)},function(t){return t.forEach(function(t){var e=r._getSafeCoords(t);!M(e,o)&&r._checkAvailGeoType(t)&&n.push(t)})}),this._updateHitGeo(n)},F.prototype._getSafeCoords=function(){var t,e,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,n=r.getCoordinates();return r.options.numberOfShellPoints&&(e=(t=r.options).numberOfShellPoints,t.numberOfShellPoints=300,r.setOptions(t),n=[r.getShell()],t.numberOfShellPoints=e||60,r.setOptions(t)),n},F.prototype._updateHitGeo=function(t){var e;this._needRefreshSymbol&&((e=this._chooseLayer.getGeometryById("_hit"))&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1),t&&0<t.length&&(this._needRefreshSymbol=!0,this.hitGeo=t[0],t=this._getSymbolOrDefault(this.hitGeo,"Hit"),this._copyGeoUpdateSymbol(this.hitGeo,t).setId("_hit"))},F.prototype._getSymbolOrDefault=function(t,e){var r=t.getSymbol(),n=this["_color"+e];if(r){for(var o in r)(o.endsWith("Fill")||o.endsWith("Color"))&&(r[o]=n);r.lineWidth=4}else r={lineColor:n,lineWidth:4};return r},F.prototype._copyGeoUpdateSymbol=function(t,e){var r=this._getSafeCoords(t);return new(t instanceof maptalks.Polygon?maptalks.Polygon:maptalks.MultiPolygon)(r).updateSymbol(e).addTo(this._chooseLayer)},F.prototype._clickEvents=function(t){var e;this.hitGeo&&(e=this._getSafeCoords(this.hitGeo),this._setChooseGeosExceptHit(e),this._updateChooseGeos())},F.prototype._setChooseGeosExceptHit=function(o){var i=this,t=this._chooseGeos.reduce(function(t,e,r){var n=i._getSafeCoords(e);return 0<r&&M(o,n)||t.push(e),t},[]);t.length===this._chooseGeos.length?this._chooseGeos.push(this.hitGeo):this._chooseGeos=t},F.prototype._updateChooseGeos=function(){var r=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=r._getSymbolOrDefault(t,"Choose");r._copyGeoUpdateSymbol(t,e)})},F.prototype._dealWithTargets=function(t){var e=this,r=void 0;if(this._deals=t.map(function(t){return null!==r&&(r=r?e._getBoolResultGeo(t,r):e._getBoolResultGeo(t)),t.copy()}),r)return r.setSymbol(this.geometry.getSymbol()),r.setProperties(this.geometry.getProperties()),r},F.prototype._getBoolResultGeo=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.geometry,r=this._getGeoJSONCoords(e),t=this._getGeoJSONCoords(t);if(!this.options.includeSame&&M(r,t))return e;e=void 0;try{e=C(r,t,this._boolType)}catch(t){}return(e=this._removeUnexpectedLine(e))?1===e.length?new maptalks.Polygon(e[0]):new maptalks.MultiPolygon(e):null},F.prototype._getGeoJSONCoords=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry).toGeoJSON().geometry.coordinates},F.prototype._removeUnexpectedLine=function(t){t=t.reduce(function(t,e){e=e.reduce(function(t,e){return 3<e.length&&t.push(e),t},[]);return 0<e.length&&t.push(e),t},[]);return 0===t.length?null:t},F);function F(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,F);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,D.call(this,t));return t._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_POLYGONBOOL",t._chooseGeos=[],t._colorHit="#ffa400",t._colorChoose="#00bcd4",t}e.mergeOptions({includeSame:!0,alterNative:[]}),t.PolygonBool=e,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.polygonbool v0.1.0, requires maptalks@>=0.31.0.")});